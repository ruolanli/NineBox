<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Day11 · 9词回合训练｜词卡 + 例句 + 错题本</title>
<style>
  :root{
    /* —— Palette（你的色板） —— */
    /* 主体冷灰蓝 */
    --navy:#151B32;           /* 夜色海军蓝（背景起点/描边建议） */
    --steel:#232E51;          /* 钢铁深蓝 */
    --indigo:#34496D;         /* 靛蓝 */
    --slate:#5E6E93;          /* 石板灰蓝（主题色） */
    --mist1:#708AAA;          /* 雾霭灰蓝（深） */
    --mist2:#A8B1C9;          /* 雾霭灰蓝（浅） */
    --mist3:#B7C6D8;          /* 雾霭灰蓝（更浅） */
    --cool:#999BB0;           /* 冷灰紫 */

    /* 高光/主体 */
    --ice:#DFDDE1;            /* 冰白/银白 */
    --lav:#C8BAC8;            /* 淡薰衣草灰（若隐） */

    /* 点缀红（极少量） */
    --crimson:#E41232;        /* 绯红（强调/按钮） */
    --rose:#E41E4B;           /* 深绛红（强调梯度2） */
    --wine:#A42C53;           /* 酒红 */

    /* 肤色/阴影（基本不用） */
    --skin:#DAC6B6;           /* 温暖米杏 */
    --roseShadow:#96616E;     /* 低饱和玫瑰影 */

    /* —— 主题变量 —— */
    --bg: var(--navy);                    /* 背景渐变起点 */
    --bg2: var(--mist2);                  /* 背景渐变终点 */
    --txt:#F7F7FA;                        /* 页面主文字：冰白（暗底） */
    --muted:var(--mist3);                 /* 次级文字 */
    --card:rgba(247,247,250,.80);         /* 冰白半透明 ≈80%（卡片底） */
    --blur:10px;
    --stroke:rgba(21,27,50,.22);          /* 深蓝描边 */

    /* 强调色：少量红色抓眼 */
    --accent:var(--crimson);
    --accent2:var(--rose);

    /* 状态色 */
    --ok:var(--slate);
    --warn:var(--roseShadow);
    --danger:var(--crimson);

    /* 浅卡片上的文字色 */
    --ink-card:#151B32;
  }

  html,body{height:100%}
  body{
    margin:0;
    background:
      radial-gradient(1100px 65% at 8% -10%, rgba(35,46,81,.55) 0%, transparent 60%),
      radial-gradient(900px 55% at 115% 25%, rgba(52,73,109,.45) 0%, transparent 55%),
      linear-gradient(180deg,var(--bg),var(--bg2));
    color:var(--txt);
    font:16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans SC","PingFang SC","Hiragino Sans GB",sans-serif;
  }

  .app{max-width:1000px;margin:0 auto;padding:20px 16px 28px}
  header.head{display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .title{display:flex;align-items:center;gap:10px}
  .title h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.3px;color:var(--mist3)}
  .badge{font-size:12px;padding:4px 8px;border:1px solid var(--stroke);border-radius:999px;background:rgba(223,221,225,.18);color:var(--mist3)}

  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .btn{
    appearance:none;border:1px solid var(--stroke);
    background:linear-gradient(180deg,rgba(255,255,255,.96),rgba(255,255,255,.86));
    color:var(--ink-card);padding:8px 12px;border-radius:10px;font-size:14px;cursor:pointer;
    backdrop-filter:blur(var(--blur));transition:.2s;display:inline-flex;align-items:center;gap:8px
  }
  .btn:hover{transform:translateY(-1px);box-shadow:0 10px 24px -16px rgba(15,26,46,.35)}
  .btn[disabled]{opacity:.55;cursor:not-allowed}

  .btn.primary{
    border-color:rgba(228,18,50,.35);
    box-shadow:inset 0 0 0 1px rgba(228,18,50,.25);
    background:linear-gradient(180deg,rgba(255,255,255,.98),rgba(255,255,255,.90));
    color:var(--ink-card);
  }
  .btn.ghost{background:transparent;color:var(--mist3)}

  .tabs{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
  .tabs .tab{padding:6px 12px;border:1px solid var(--stroke);border-radius:999px;font-size:13px;color:var(--mist3);cursor:pointer;background:rgba(255,255,255,.03)}
  .tabs .tab.active{color:var(--ice);border-color:rgba(94,110,147,.45);box-shadow:inset 0 0 0 1px rgba(94,110,147,.35)}

  /* 网格卡片 */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
  @media (max-width:760px){.grid{grid-template-columns:repeat(2,1,fr)}}
  @media (max-width:520px){.grid{grid-template-columns:1fr}}
  .card{
    position:relative;padding:16px;border-radius:16px;
    background:var(--card);
    border:1px solid var(--stroke);
    backdrop-filter:blur(var(--blur));
    min-height:120px;display:flex;flex-direction:column;gap:8px;
    color:var(--ink-card);
  }
  .term{font-size:22px;font-weight:800;letter-spacing:.2px;margin:6px 0;color:var(--navy)}
  .cn{color:var(--ok);font-size:18px;display:none}
  .cn.show{display:block}
  .meta{font-size:12px;color:var(--slate)}
  .toolbar{position:absolute;top:8px;right:8px;display:flex;gap:6px}
  .iconbtn{
    border:1px solid var(--stroke);background:rgba(255,255,255,.92);
    width:34px;height:32px;border-radius:9px;display:grid;place-items:center;
    color:var(--slate);cursor:pointer
  }
  .iconbtn.active{color:var(--crimson);box-shadow:inset 0 0 0 1px rgba(228,18,50,.35)}
  .iconbtn:hover{transform:translateY(-1px)}

  /* 例句区域 */
  .sentences{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
  .sentence{
    padding:16px 16px;border-radius:14px;background:var(--card);
    border:1px solid var(--stroke);backdrop-filter:blur(var(--blur));
    color:var(--ink-card);
  }
  .en{font-weight:700;color:var(--navy)}
  .zh{display:none;color:var(--ok)}
  .zh.show{display:block;margin-top:6px}

  footer.foot{margin-top:16px;display:flex;gap:10px;align-items:center;justify-content:space-between;color:var(--mist3)}
  .meter{height:8px;background:rgba(247,247,250,.15);border-radius:999px;overflow:hidden;flex:1}
  .bar{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}

  /* 模态层 */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(10,12,20,.35);backdrop-filter:blur(6px);z-index:40}
  .modal.show{display:grid}
  .dialog{
    width:min(720px,92vw);
    background:linear-gradient(180deg,rgba(255,255,255,1),rgba(255,255,255,.92));
    border:1px solid var(--stroke);border-radius:16px;padding:18px;color:var(--ink-card)
  }

  /* 彩纸 */
  .burst{position:fixed;pointer-events:none;inset:0;overflow:hidden;z-index:60}
  .piece{position:absolute;width:8px;height:12px;opacity:0;animation:pop 1s ease-out forwards}
  @keyframes pop{0%{transform:translate(var(--x),var(--y)) rotate(0) scale(.8);opacity:1}
                 100%{transform:translate(var(--x2),var(--y2)) rotate(720deg) scale(1);opacity:0}}

  .hint{font-size:12px;color:var(--mist1)}
</style>
</head>
<body>
  <div class="app">
    <header class="head">
      <div class="title" id="title">
        <span class="badge">Day11</span>
        <h1>9词回合训练 · 词卡 ↔ 例句 · 错题本</h1>
      </div>
      <div class="controls">
        <button class="btn" id="prevBtn">← 上一回合</button>
        <button class="btn primary" id="toggleViewBtn">切换到例句页</button>
        <button class="btn" id="nextBtn">下一回合 →</button>
        <button class="btn ghost" id="showAllBtn">显示全部译文</button>
        <button class="btn ghost" id="hideAllBtn">隐藏全部译文</button>
        <button class="btn" id="shuffleBtn">随机顺序</button>
        <button class="btn" id="wrongTabBtn">错题本</button>
        <button class="btn" id="deckTabBtn" style="display:none">返回词库</button>
        <button class="btn" id="miniGameBtn">🎮 翻译挑战</button>
        <button class="btn ghost" id="eggBtn" title="小惊喜">🎁</button>
      </div>
      <div class="hint">提示：点击单词即可<span style="color:var(--ok)">发音 + 显示翻译</span>；📌图钉加入错题本；💬查看例句。</div>
    </header>

    <section id="wordsView">
      <div class="grid" id="grid"></div>
    </section>

    <section id="sentencesView" style="display:none">
      <div class="controls" style="margin-top:4px">
        <button class="btn" id="shuffleSentBtn">换一组例句</button>
        <button class="btn ghost" id="showAllZhSent">显示全部译文</button>
        <button class="btn ghost" id="hideAllZhSent">隐藏全部译文</button>
      </div>
      <div class="sentences" id="sentences"></div>
    </section>

    <footer class="foot">
      <div id="status">回合 <span id="roundIdx">1</span>/<span id="roundTotal">1</span> · 本回合词数 <span id="roundCount">0</span> · 错题本 <span id="wrongCount">0</span></div>
      <div class="meter"><div class="bar" id="bar"></div></div>
    </footer>
  </div>

  <!-- 例句弹窗 -->
  <div class="modal" id="exampleModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <h3 id="exTitle" style="margin:0;color:#151B32">例句</h3>
        <button class="btn" id="closeEx">关闭</button>
      </div>
      <div style="margin-top:10px" id="exContent"></div>
    </div>
  </div>

  <!-- 翻译挑战弹窗 -->
  <div class="modal" id="quizModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <h3 id="quizTitle" style="margin:0;color:#151B32">🎯 翻译挑战（输入中文义）</h3>
        <button class="btn" id="closeQuiz">关闭</button>
      </div>
      <div id="quizWrap" style="margin-top:12px"></div>
    </div>
  </div>

  <div class="burst" id="burst"></div>

<script>
/* ───────────────────────── 词库（唯一词条） ───────────────────────── */
/* 这里放的是你给我的新增那批词（可继续扩展）。若你有更早的 base，也可以合并。 */
const base = [
  {t:'overcome', cn:'克服', ex:[
    'To overcome insecurity, she adopted an incremental strategy and postponed any restrictive options until more data became available.',
    '为克服不安全感，她采用渐进式策略，并将任何带限制性的选项推迟到有更多数据可用为止。'
  ]},
  {t:'encourage', cn:'鼓励', ex:[
    'We encourage international students to register early, adapt to the new ecosystem, and engage with the survey before choosing an option.',
    '我们鼓励国际学生尽早注册，适应新的生态系统，并在选择选项前先参与问卷。'
  ]},
  {t:'recommend', cn:'推荐；建议', ex:[
    'The accountant would recommend a conservative loan strategy to reduce potential loss and maintain steady cash movement.',
    '会计会建议采取保守的贷款策略，以降低潜在损失并保持现金流稳定。'
  ]},
  {t:'expose', cn:'暴露；揭示', ex:[
    'The survey exposed a substantial shortage of proper maintenance in traditional housing, resulting in negative health consequences.',
    '这份调查揭示出传统住宅在规范维护方面存在显著短缺，带来不良的健康后果。'
  ]},
  {t:'postpone', cn:'推迟', ex:[
    'Due to an urgent notification, we postponed the harvest and arranged an alternative option instead.',
    '由于收到紧急通知，我们推迟了收获，并改为安排了备选方案。'
  ]},
  {t:'arrange', cn:'安排；筹划', ex:[
    'Please arrange a proper recipe for the event, reserve a venue at equal distance, and send notifications to all accounts.',
    '请为活动安排合适的菜单，预留距离相近的场地，并向所有账号发送通知。'
  ]},
  {t:'conserve', cn:'保护；保存', ex:[
    'To conserve the coastal habitat, the plan adopts restrictive zoning and encourages residents to reduce water use.',
    '为保护海岸栖息地，方案采用了限制性分区，并鼓励居民减少用水。'
  ]},
  {t:'discourage', cn:'阻止；打消', ex:[
    'The policy discourages unintentional waste by exposing the real cost and recommending adaptable recipes to reuse leftovers.',
    '该政策通过揭示真实成本并推荐可调整的菜谱来再利用剩菜，从而抑制无意的浪费。'
  ]},
  {t:'reduce', cn:'减少；降低', ex:[
    'We reduced rent by adopting a broader pricing option, which significantly increased potential engagement.',
    '我们采用更宽泛的定价选项来降低房租，从而显著提升了潜在参与度。'
  ]},
  {t:'request', cn:'请求；申请', ex:[
    'Your request to postpone the loan requires approval; please register online and quote your account number.',
    '你关于推迟贷款的请求需要审批；请在线注册并注明你的账号。'
  ]},
  {t:'responsibility', cn:'责任', ex:[
    'It is your responsibility to arrange proper maintenance and report any loss immediately.',
    '安排规范维护并立刻上报任何损失是你的责任。'
  ]},
  {t:'consequence', cn:'后果；结果', ex:[
    'One consequence of a restrictive strategy is reduced engagement and a shortage of available options.',
    '限制性策略的一个后果是参与度降低、可用选项短缺。'
  ]},
  {t:'psychology', cn:'心理学；心理', ex:[
    'Consumer psychology shows that broad options can encourage choice but also expose insecurity.',
    '消费者心理表明，宽泛的选项能鼓励选择，但也可能暴露不安全感。'
  ]},
  {t:'insecurity', cn:'不安全感', ex:[
    'Her insecurity about the novel concept discouraged her from adopting the approach despite substantial potential.',
    '她对这一新概念的不安全感使她放弃采用这种方法，尽管其潜力可观。'
  ]},
  {t:'approach', cn:'方法；途径', ex:[
    'Our approach is to survey the ecosystem, register the risks, and adapt the strategy before any attack on the problem.',
    '我们的方法是先调研生态系统、登记风险并调整策略，再着手攻克问题。'
  ]},
  {t:'concept', cn:'概念；观念', ex:[
    'The concept of equal access recommends reducing distance barriers and providing available loans.',
    '“平等获取”的概念建议减少距离障碍，并提供可用的贷款。'
  ]},
  {t:'maintenance', cn:'维护；保养', ex:[
    'Regular maintenance reduces unintentional failures and keeps the wheel assembly steady during movement.',
    '定期维护可减少无意的故障，并在运动中保持车轮组件的稳定。'
  ]},
  {t:'ecosystem', cn:'生态系统', ex:[
    'A healthy ecosystem requires habitat conservation, proper waste reduction, and engagement across international borders.',
    '健康的生态系统需要栖息地保护、规范的减废，以及跨国参与。'
  ]},
  {t:'habitat', cn:'栖息地', ex:[
    'The team surveyed the wetland habitat and adopted a strategy to reserve corridors for animal movement.',
    '团队调查了湿地栖息地，并采取策略预留动物迁徙廊道。'
  ]},
  {t:'loan', cn:'贷款', ex:[
    'We recommend a loan only if the accountant can account for the risk of loss and quote a proper rate.',
    '只有当会计能清楚核算损失风险并报出合适利率时，我们才建议贷款。'
  ]},
  {t:'notification', cn:'通知；通告', ex:[
    'You will receive a notification to register, arrange your duty schedule, and confirm any urgent request.',
    '你将收到通知以进行注册、安排值班日程，并确认任何紧急请求。'
  ]},
  {t:'strategy', cn:'策略；战略', ex:[
    'Our strategy is to broaden available options, discourage negative attacks, and encourage steady engagement.',
    '我们的策略是扩大可用选项、抑制负面攻击，并鼓励稳定参与。'
  ]},
  {t:'unintentional', cn:'无意的；非本意的', ex:[
    'An unintentional data exposure can significantly reduce trust and require international notification by law.',
    '一次无意的数据泄露会显著降低信任，并依法需要进行国际通报。'
  ]},
  {t:'available', cn:'可用的；可获得的', ex:[
    'Several available options allow you to postpone payment, adopt a cheaper rent, or request a loan.',
    '多种可用选项允许你推迟付款、采用更低的房租，或申请贷款。'
  ]},
  {t:'international', cn:'国际的', ex:[
    'International students often adopt flexible strategies to overcome distance and register despite time zones.',
    '国际学生往往采用灵活策略来克服距离障碍，并在时差下完成注册。'
  ]},
  {t:'novel', cn:'新颖的；小说的', ex:[
    'The novel ecosystem model recommends conserving habitat while allowing adaptable human movement.',
    '这个新颖的生态系统模型建议在保护栖息地的同时，允许可调整的人类活动。'
  ]},
  {t:'restrictive', cn:'限制性的', ex:[
    'Restrictive policies may discourage engagement, reduce potential growth, and postpone novel approaches.',
    '限制性政策可能抑制参与、降低潜在增长，并推迟新方法的实施。'
  ]},
  {t:'substantial', cn:'大量的；实质性的', ex:[
    'A substantial shortage of parts forced us to adopt a broad procurement strategy and postpone the project.',
    '零件的大量短缺迫使我们采取广域采购策略，并推迟项目。'
  ]},
  {t:'traditional', cn:'传统的', ex:[
    'Traditional recipes can be adapted to reduce sugar and respect restrictive diets without losing flavor.',
    '传统菜谱可以进行改良以减少糖分，并尊重限制性饮食，同时不失风味。'
  ]},
  {t:'significantly', cn:'显著地', ex:[
    'The new approach significantly reduced maintenance costs and encouraged broader engagement.',
    '新方法显著降低了维护成本，并鼓励了更广泛的参与。'
  ]},
  {t:'type', cn:'类型', ex:[
    'Please select the account type and register your option before the deadline.',
    '请在截止日期前选择账号类型并登记你的选项。'
  ]},
  {t:'movement', cn:'运动；移动', ex:[
    'The survey recorded steady movement across the bridge despite the distance and strong wind.',
    '尽管距离远且风力强，调查仍记录到稳定的桥上通行。'
  ]},
  {t:'shortage', cn:'短缺', ex:[
    'The report quotes a shortage of accountants, which could reduce available loan options and increase rent.',
    '报告引用的数据显示会计人员短缺，这可能减少可用贷款选项并推高房租。'
  ]},
  {t:'loss', cn:'损失', ex:[
    'To prevent loss, the strategy recommends adopting backups and arranging proper maintenance.',
    '为防止损失，策略建议采用备份并安排规范维护。'
  ]},
  {t:'broad', cn:'广泛的；宽的', ex:[
    'We prefer a broad approach that engages multiple ecosystems and international partners.',
    '我们更倾向于一种能联结多重生态系统与国际伙伴的广泛方法。'
  ]},
  {t:'broaden', cn:'拓宽；扩大', ex:[
    'We broaden options to encourage equal access and reduce insecurity.',
    '我们扩大选项以鼓励平等获取，并降低不安全感。'
  ]},
  {t:'attack', cn:'抨击；攻击', ex:[
    'A negative attack on the concept only exposes insecurity and discourages engagement.',
    '对该概念的负面抨击只会暴露不安全感并打击参与。'
  ]},
  {t:'register', cn:'注册；登记', ex:[
    'You must register for the survey, request a quote, and confirm your preferred option.',
    '你必须登记参与调查、索取报价，并确认你的优选方案。'
  ]},
  {t:'potential', cn:'潜力；潜在的', ex:[
    'The accountant evaluated the potential loss and recommended postponing any loan.',
    '会计评估了潜在损失，并建议暂缓任何贷款。'
  ]},
  {t:'option', cn:'选项', ex:[
    'One option is to rent equipment; another is to adopt a maintenance plan to reduce costs.',
    '一个选项是租设备；另一个是采用维护计划来降低成本。'
  ]},
  {t:'adapt', cn:'适应；改编', ex:[
    'We adapted the traditional recipe to conserve water and respect cultural habits.',
    '我们改良了传统食谱，以节水并尊重文化习惯。'
  ]},
  {t:'adaptable', cn:'可适应的；可调整的', ex:[
    'An adaptable strategy allows international teams to overcome distance and engage steadily.',
    '可调整的策略能让国际团队克服距离并稳定参与。'
  ]},
  {t:'account', cn:'账户；解释；考虑', ex:[
    'Please account for unintentional costs and quote a more realistic, substantial budget.',
    '请把无意成本计算在内，并给出更为合理、实质的预算报价。'
  ]},
  {t:'accountant', cn:'会计', ex:[
    'The accountant arranged notifications, registered the loan, and recommended a conservative approach.',
    '会计安排了通知，登记了贷款，并建议采用保守做法。'
  ]},
  {t:'adopt', cn:'采用；收养', ex:[
    'They adopted a restrictive policy to conserve habitat while offering available relocation options.',
    '他们采用限制性政策来保护栖息地，同时提供可用的迁移选项。'
  ]},
  {t:'distance', cn:'距离', ex:[
    'Long distance can discourage engagement, but international tools significantly reduce the impact.',
    '较远距离可能打击参与，但国际化工具能显著降低其影响。'
  ]},
  {t:'equal', cn:'平等的；相等的', ex:[
    'Our policy ensures equal access, recommending available loans and reduced rent for students.',
    '我们的政策确保平等获取，推荐为学生提供可用贷款并降低房租。'
  ]},
  {t:'instead', cn:'相反；而不是', ex:[
    'Instead of an urgent attack, we adopted a steady strategy and broadened options.',
    '我们没有急于“进攻”，而是采用稳健策略并扩大了选项。'
  ]},
  {t:'moreover', cn:'而且；此外', ex:[
    'Moreover, the survey quoted significant improvement after we encouraged adaptable, international cooperation.',
    '此外，调查引用的数据表明，在我们鼓励可调整的国际合作后，改善显著。'
  ]},
  {t:'previous', cn:'先前的', ex:[
    'Compared with the previous approach, the novel strategy reduced maintenance costs and broadened engagement.',
    '与先前方法相比，这一新策略降低了维护成本并扩大了参与。'
  ]},
  {t:'choice', cn:'选择', ex:[
    'Her choice to postpone the loan was recommended by the accountant after a negative risk survey.',
    '在一份负面风险评估后，会计建议她推迟贷款，她也据此作出选择。'
  ]},
  {t:'wheel', cn:'轮子；车轮', ex:[
    'A loose wheel can cause loss of control; proper maintenance is not optional.',
    '轮子松动会导致失控；规范维护绝不是“可有可无”。'
  ]},
  {t:'besides', cn:'此外；除…之外', ex:[
    'Besides rent, your account shows a substantial loan and several international notifications.',
    '除房租外，你的账户还显示有一笔可观贷款和多条国际通知。'
  ]},
  {t:'response', cn:'回应；反应', ex:[
    'Our response was to adopt a broad strategy, encourage engagement, and reduce restrictive barriers.',
    '我们的回应是采取广域策略、鼓励参与，并减少限制性壁垒。'
  ]},
  {t:'harvest', cn:'收获；收割', ex:[
    'To protect the ecosystem, we arranged surveys of animal movement and set restrictive rules on harvest seasons.',
    '为保护生态系统，我们安排了动物迁徙调查，并对收获季设定了限制性规则。'
  ]},
  {t:'decorate', cn:'装饰；布置', ex:[
    'We decorated the traditional venue, arranged recipes, and encouraged guests to engage and interact.',
    '我们布置了传统场地，安排了菜单，并鼓励嘉宾积极互动。'
  ]},
  {t:'survey', cn:'调查；测量', ex:[
    'The national survey exposed a shortage of habitat and recommended conserving broad corridors.',
    '全国调查揭示栖息地短缺，并建议保护宽阔的生态廊道。'
  ]},
  {t:'reserve', cn:'预订；保留', ex:[
    'Please reserve seats at equal distance and request a vegetarian recipe if needed.',
    '请预订彼此距离相近的座位，如需素食菜单请提出申请。'
  ]},
  {t:'interact', cn:'互动；交互', ex:[
    'Students interact in international groups, adopt adaptable strategies, and engage despite distance.',
    '学生在国际小组中互动，采用可调整策略，并不因距离而放弃参与。'
  ]},
  {t:'negative', cn:'消极的；负面的', ex:[
    'Negative quotes on social media significantly reduced engagement and exposed insecurity.',
    '社交媒体上的负面言论显著降低了参与度，并暴露出不安全感。'
  ]},
  {t:'result', cn:'结果；导致', ex:[
    'The result of the strategy was substantial: we reduced rent, broadened options, and encouraged steady adoption.',
    '该策略的结果是显著的：我们降低了房租、扩大了选项，并鼓励了稳定采纳。'
  ]},
  {t:'demand', cn:'需求；要求', ex:[
    'High demand and a shortage of parts forced us to postpone production and request international support.',
    '高需求与零件短缺迫使我们推迟生产，并寻求国际支持。'
  ]},
  {t:'proper', cn:'合适的；正当的', ex:[
    'Proper maintenance and steady movement reduce the risk of wheel failure.',
    '规范的维护与平稳的运动能降低车轮故障风险。'
  ]},
  {t:'urgent', cn:'紧急的', ex:[
    'An urgent notification asked us to arrange a loan and register the account immediately.',
    '一则紧急通知要求我们立即安排贷款并登记账户。'
  ]},
  {t:'recipe', cn:'菜谱；配方', ex:[
    'This novel recipe adapts traditional flavors, reduces sugar, and respects restrictive diets.',
    '这道新配方在保留传统风味的同时减少了糖分，并尊重限制性饮食。'
  ]},
  {t:'regard', cn:'关于；看待', ex:[
    'With regard to rent, one option is to request a loan; another is to adopt a savings strategy.',
    '关于房租，一个选项是申请贷款；另一个是采用储蓄策略。'
  ]},
  {t:'rent', cn:'租金；租用', ex:[
    'We negotiated the rent and adopted a strategy to reduce costs without sacrificing maintenance.',
    '我们议定了房租，并采用策略在不牺牲维护的前提下降低成本。'
  ]},
  {t:'respect', cn:'尊重；方面', ex:[
    'We respect international diversity and encourage equal opportunities to engage and register.',
    '我们尊重国际多样性，并鼓励人人享有平等参与与注册的机会。'
  ]},
  {t:'duty', cn:'职责；义务', ex:[
    'It is your duty to account for expenses, arrange maintenance, and respond to urgent notifications.',
    '你有义务核算开销、安排维护并对紧急通知做出回应。'
  ]},
  {t:'engage', cn:'参与；吸引', ex:[
    'We engage the community with a broad, adaptable approach that significantly reduces insecurity.',
    '我们以广泛且可调整的方法动员社区，从而显著降低不安全感。'
  ]},
  {t:'steady', cn:'稳定的；稳步的', ex:[
    'A steady approach—survey, register, and adapt—reduced loss and improved potential.',
    '稳健的方法——调研、登记与适应——减少了损失并提升了潜力。'
  ]},
  {t:'quote', cn:'引用；报价', ex:[
    'Please quote the loan rate, register the account, and arrange options before you adopt a strategy.',
    '请先报出贷款利率、登记账户并安排可选方案，再确定要采用的策略。'
  ]},
];

/* ───────────────────────── 构建索引与状态 ───────────────────────── */
const deckOrder = base.map(b=>b.t);               // 原始顺序，用于还原
const map = new Map(base.map((b,i)=>[b.t,i]));    // 词到索引
let deck = deckOrder.map(t=>base[map.get(t)]);    // 当前主词库顺序（可洗牌）

let currentRound = 0;
const pageSize = 9;
let inSentencesView = false;
let scrambled = false;

let wrongBook = new Set(JSON.parse(localStorage.getItem('wrongBook_v1')||'[]'));
let inWrongMode = false;
let wrongOrder = [...wrongBook]; // 用于“错题本”列表的稳定顺序（可洗牌）

/* ───────────────────────── 工具函数 ───────────────────────── */
function speak(text, lang='en-US'){
  try{
    const u = new SpeechSynthesisUtterance(text);
    const voices = speechSynthesis.getVoices();
    const en = voices.find(v=>/en[-_](US|GB)|English/i.test(v.lang)) || voices[0];
    if(en) u.voice = en; u.lang = en?.lang || lang; u.rate = 0.95; u.pitch = 1; u.volume = 1;
    speechSynthesis.cancel(); speechSynthesis.speak(u);
  }catch(e){console.warn('TTS failed:',e)}
}
function saveWrong(){
  localStorage.setItem('wrongBook_v1', JSON.stringify([...wrongBook]));
  // 维护 wrongOrder 稳定顺序（遵循 Set 插入顺序）
  wrongOrder = [...wrongBook];
}
function chunk(arr, size){ const out=[]; for(let i=0;i<arr.length;i+=size) out.push(arr.slice(i,i+size)); return out; }
function randPick(arr, k){ const a=[...arr]; a.sort(()=>Math.random()-0.5); return a.slice(0, k); }
function getWrongDeck(){
  // 根据 wrongOrder 取词条，保持和洗牌后的一致顺序
  return wrongOrder.map(t=> base[map.get(t)]).filter(Boolean);
}
function setBar(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  if(total <= 0){ document.getElementById('bar').style.width = '0%'; return; }
  const totalRounds = Math.max(1, Math.ceil(total/pageSize));
  const pct = ((currentRound) / (totalRounds-1 || 1)) * 100;
  document.getElementById('bar').style.width = pct + '%';
}

/* ───────────────────────── 渲染函数 ───────────────────────── */
function renderWords(){
  inSentencesView = false;
  document.getElementById('wordsView').style.display='block';
  document.getElementById('sentencesView').style.display='none';
  document.getElementById('toggleViewBtn').textContent='切换到例句页';

  const arr = inWrongMode ? getWrongDeck() : deck;
  const rounds = chunk(arr, pageSize);
  const totalRounds = rounds.length;
  currentRound = Math.max(0, Math.min(currentRound, Math.max(0,totalRounds-1)));
  const round = rounds[currentRound] || [];

  const g = document.getElementById('grid');
  g.innerHTML='';

  if(inWrongMode && arr.length===0){
    g.innerHTML = '<div class="card" style="border-style:dashed;opacity:.9"><div class="term">错题本是空的</div><div class="meta">在词卡页点击📌加入后再来复习</div></div>';
    document.getElementById('roundIdx').textContent = 0;
    document.getElementById('roundTotal').textContent = 0;
    document.getElementById('roundCount').textContent = 0;
    setBar(); return;
  }

  round.forEach(item=>{
    const card = document.createElement('div');
    card.className='card';

    const tb = document.createElement('div'); tb.className='toolbar';

    const exBtn = document.createElement('button');
    exBtn.className='iconbtn'; exBtn.title='例句'; exBtn.innerHTML='💬';
    exBtn.onclick = ()=>openExample(item);

    const pin = document.createElement('button');
    pin.className='iconbtn'; pin.title='加入/移出错题本'; pin.innerHTML='📌';
    if(wrongBook.has(item.t)) pin.classList.add('active');
    pin.onclick = ()=>{
      if(wrongBook.has(item.t)) wrongBook.delete(item.t); else wrongBook.add(item.t);
      pin.classList.toggle('active'); saveWrong(); updateFooter();
    };

    tb.appendChild(exBtn); tb.appendChild(pin);

    const term = document.createElement('div');
    term.className='term'; term.textContent = item.t;
    term.setAttribute('role','button');

    const cn = document.createElement('div'); cn.className='cn'; cn.textContent = item.cn;

    term.onclick = ()=>{ speak(item.t); cn.classList.toggle('show'); maybeSurprise(); };

    const meta = document.createElement('div'); meta.className='meta'; meta.textContent='点击单词：发音 + 显示中文';

    card.appendChild(tb); card.appendChild(term); card.appendChild(cn); card.appendChild(meta);
    g.appendChild(card);
  });

  // 补位（不足9个）
  const remain = pageSize - round.length;
  for(let i=0;i<remain;i++){
    const ghost = document.createElement('div');
    ghost.className='card';
    ghost.style.opacity=.5; ghost.style.borderStyle='dashed';
    ghost.innerHTML='<div class="meta">（本回合不足九个）</div>';
    g.appendChild(ghost);
  }

  document.getElementById('roundIdx').textContent = (currentRound+1);
  document.getElementById('roundTotal').textContent = totalRounds;
  document.getElementById('roundCount').textContent = round.length;
  setBar();
}

function renderSentences(){
  inSentencesView = true;
  document.getElementById('wordsView').style.display='none';
  document.getElementById('sentencesView').style.display='block';
  document.getElementById('toggleViewBtn').textContent='切换到词卡页';

  const arr = inWrongMode ? getWrongDeck() : deck;
  const rounds = chunk(arr, pageSize);
  const round = rounds[currentRound] || [];
  const box = document.getElementById('sentences');
  box.innerHTML='';

  if(inWrongMode && arr.length===0){
    const s = document.createElement('div'); s.className='sentence';
    s.innerHTML = '<div class="en">错题本暂无例句</div><div class="zh show">先回到词库页添加一些📌吧</div>';
    box.appendChild(s); return;
  }

  const k = Math.min(3, Math.max(2, Math.floor(Math.random()*2)+2));
  const pick = randPick(round, Math.min(k, round.length));

  pick.forEach(item=>{
    const s = document.createElement('div'); s.className='sentence';
    const en = document.createElement('div'); en.className='en'; en.textContent=item.ex[0];
    const zh = document.createElement('div'); zh.className='zh'; zh.textContent=item.ex[1];
    s.appendChild(en); s.appendChild(zh);
    s.onclick=()=> zh.classList.toggle('show');
    box.appendChild(s);
  });
}

/* ───────────────────────── 弹窗 & 交互 ───────────────────────── */
function openExample(item){
  document.getElementById('exTitle').textContent = `📘 ${item.t}`;
  const c = document.getElementById('exContent');
  c.innerHTML = '';
  const en = document.createElement('div'); en.className='en'; en.textContent=item.ex[0];
  const zh = document.createElement('div'); zh.className='zh show'; zh.textContent=item.ex[1];
  const p = document.createElement('div'); p.className='hint'; p.textContent='点击英文发音';
  en.onclick=()=>speak(item.ex[0]);
  c.appendChild(en); c.appendChild(zh); c.appendChild(p);
  document.getElementById('exampleModal').classList.add('show');
}

/* 撒花 */
function confetti(){
  const b = document.getElementById('burst');
  for(let i=0;i<32;i++){
    const p=document.createElement('div'); p.className='piece';
    const x = (window.innerWidth/2)+'px'; const y = '20%';
    const x2 = (Math.random()*100)+'vw'; const y2 = (60+Math.random()*40)+'vh';
    p.style.setProperty('--x', x); p.style.setProperty('--y', y);
    p.style.setProperty('--x2', x2); p.style.setProperty('--y2', y2);
    p.style.background = `linear-gradient(${Math.random()*360}deg, var(--accent), var(--accent2))`;
    p.style.left = (window.innerWidth/2)+'px'; p.style.top='10%';
    b.appendChild(p); setTimeout(()=>p.remove(), 1000);
  }
}

/* 翻译挑战 */
let quizItem = null;
function openQuiz(fromWrong=false, promptText='🎯 翻译挑战（输入中文义）'){
  const roundArr = inWrongMode ? (chunk(getWrongDeck(), pageSize)[currentRound]||[]) : (chunk(deck, pageSize)[currentRound]||[]);
  const pool = fromWrong ? getWrongDeck() : (roundArr.length ? roundArr : deck);
  if(pool.length===0){ alert('本回合暂无词条'); return; }
  quizItem = pool[(Math.random()*pool.length)|0];

  document.getElementById('quizTitle').textContent = promptText;

  const wrap = document.getElementById('quizWrap');
  wrap.innerHTML = '';

  const q = document.createElement('div'); q.className='en'; q.style.marginBottom='8px';
  q.textContent = `请翻译：${quizItem.t}`;

  const input = document.createElement('input');
  input.placeholder='输入中文意思';
  input.style.width='100%'; input.style.padding='10px';
  input.style.borderRadius='10px'; input.style.border='1px solid var(--stroke)';
  input.style.background='rgba(255,255,255,.9)'; input.style.color='var(--ink-card)';

  const bar = document.createElement('div'); bar.style.display='flex'; bar.style.gap='8px'; bar.style.marginTop='10px';
  const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='提交';
  const reveal = document.createElement('button'); reveal.className='btn'; reveal.textContent='显示答案';
  const addWrong = document.createElement('button'); addWrong.className='btn'; addWrong.textContent='加入错题本 📌';
  bar.appendChild(btn); bar.appendChild(reveal); bar.appendChild(addWrong);

  const res = document.createElement('div'); res.className='hint'; res.style.marginTop='8px';

  btn.onclick = ()=>{
    const user = (input.value||'').trim();
    if(!user){ res.textContent='先输入你的翻译~'; return; }
    const ans = (quizItem.cn||'').replace(/[；;，,。]/g,' ');
    let ok=false;
    const parts = ans.split(/\s+/).filter(Boolean);
    for(const p of parts){ if(p && user.includes(p)) { ok=true; break; } }
    if(ok){ res.textContent='✅ 记得不错！'; confetti(); }
    else { res.textContent='❌ 再想想。正确答案：'+quizItem.cn; }
  };
  reveal.onclick = ()=>{ res.textContent='答案：'+quizItem.cn; };
  addWrong.onclick = ()=>{ wrongBook.add(quizItem.t); saveWrong(); updateFooter(); addWrong.classList.add('active'); };

  wrap.appendChild(q); wrap.appendChild(input); wrap.appendChild(bar); wrap.appendChild(res);
  document.getElementById('quizModal').classList.add('show');
}

/* 偶遇测验（随机弹出错题本词或例句） */
let surpriseCooldown = false;
function maybeSurprise(){
  if (document.querySelector('.modal.show')) return; // 已有弹窗则不打断
  if (wrongBook.size === 0) return;
  if (surpriseCooldown) return;

  // 触发概率：词卡页 18%，例句页 12%
  const p = inSentencesView ? 0.12 : 0.18;
  if (Math.random() >= p) return;

  surpriseCooldown = true;

  if (Math.random() < 0.5){
    openQuiz(true, '🫣 本单词还没有记熟哦，快来复习一下吧~');
  } else {
    const pool = getWrongDeck();
    const item = pool[(Math.random()*pool.length)|0];
    if(!item){ openQuiz(true, '🫣 本单词还没有记熟哦，快来复习一下吧~'); }
    else {
      const ex = Array.isArray(item.ex) ? item.ex : [];
      document.getElementById('exTitle').textContent = `🫣 你还没背过我：${item.t}`;
      const c = document.getElementById('exContent');
      c.innerHTML = '';
      const tip = document.createElement('div'); tip.className='hint';
      tip.textContent = '点英文可发音，点译文可显示/隐藏';
      const en = document.createElement('div'); en.className='en';
      en.textContent = ex[0] || '(暂无例句)'; en.onclick = ()=> speak(en.textContent);
      const zh = document.createElement('div'); zh.className = 'zh';
      zh.textContent = ex[1] || '（译文暂缺，先自己猜猜）';
      c.appendChild(tip); c.appendChild(en); c.appendChild(zh);
      document.getElementById('exampleModal').classList.add('show');
    }
  }

  // 20秒冷却，避免过于频繁
  setTimeout(()=>{ surpriseCooldown = false; }, 20000);
}

/* ───────────────────────── 其他控制 ───────────────────────── */
function updateFooter(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  const rounds = Math.max(1, Math.ceil(total / pageSize));
  document.getElementById('roundTotal').textContent = rounds;
  const roundArr = inWrongMode
    ? (chunk(getWrongDeck(), pageSize)[currentRound] || [])
    : (chunk(deck, pageSize)[currentRound] || []);
  document.getElementById('roundCount').textContent = roundArr.length;
  document.getElementById('roundIdx').textContent = currentRound + 1;
  document.getElementById('wrongCount').textContent = wrongBook.size;
  setBar();
}

function prevRound(){
  if(currentRound>0){ currentRound--; (inSentencesView?renderSentences():renderWords()); updateFooter(); maybeSurprise(); }
}
function nextRound(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  const rounds = Math.ceil(total / pageSize);
  if(currentRound < rounds - 1){ currentRound++; (inSentencesView?renderSentences():renderWords()); updateFooter(); maybeSurprise(); }
}
function toggleView(){ inSentencesView ? renderWords() : renderSentences(); updateFooter(); maybeSurprise(); }

function showAllCN(){ document.querySelectorAll('#grid .cn').forEach(el=>el.classList.add('show')); }
function hideAllCN(){ document.querySelectorAll('#grid .cn').forEach(el=>el.classList.remove('show')); }
function showAllZhSent(){ document.querySelectorAll('#sentences .zh').forEach(el=>el.classList.add('show')); }
function hideAllZhSent(){ document.querySelectorAll('#sentences .zh').forEach(el=>el.classList.remove('show')); }

/* 洗牌：主词库与错题本分别维护各自顺序 */
function resetDeck(){ deck = deckOrder.map(t=>base[map.get(t)]); }
function shuffleDeck(){
  scrambled = !scrambled;
  if(inWrongMode){
    // 洗牌错题本顺序
    wrongOrder = [...wrongBook];
    if(scrambled) wrongOrder.sort(()=>Math.random()-0.5);
  }else{
    if(scrambled) deck.sort(()=>Math.random()-0.5);
    else resetDeck();
  }
  currentRound = 0;
  (inSentencesView?renderSentences():renderWords());
  updateFooter();
  maybeSurprise();
}

/* 切换错题本视图 */
function enterWrong(){
  inWrongMode = true; currentRound = 0;
  document.getElementById('deckTabBtn').style.display='inline-flex';
  document.getElementById('wrongTabBtn').style.display='none';
  if(scrambled) wrongOrder.sort(()=>Math.random()-0.5); else wrongOrder = [...wrongBook];
  renderWords(); updateFooter();
}
function leaveWrong(){
  inWrongMode = false; currentRound = 0;
  document.getElementById('deckTabBtn').style.display='none';
  document.getElementById('wrongTabBtn').style.display='inline-flex';
  renderWords(); updateFooter();
}

/* ───────────────────────── 事件绑定 ───────────────────────── */
window.addEventListener('load', ()=>{
  renderWords();
  updateFooter();
  setTimeout(()=>speechSynthesis.getVoices(), 300); // 预热语音
});

document.getElementById('prevBtn').onclick = prevRound;
document.getElementById('nextBtn').onclick = nextRound;
document.getElementById('toggleViewBtn').onclick = toggleView;

document.getElementById('showAllBtn').onclick = showAllCN;
document.getElementById('hideAllBtn').onclick = hideAllCN;

document.getElementById('shuffleBtn').onclick = shuffleDeck;
document.getElementById('wrongTabBtn').onclick = enterWrong;
document.getElementById('deckTabBtn').onclick = leaveWrong;

document.getElementById('miniGameBtn').onclick = ()=>openQuiz(false, '🎯 翻译挑战（输入中文义）');
document.getElementById('eggBtn').onclick = confetti;

document.getElementById('shuffleSentBtn').onclick = ()=>{ renderSentences(); maybeSurprise(); };
document.getElementById('showAllZhSent').onclick = showAllZhSent;
document.getElementById('hideAllZhSent').onclick = hideAllZhSent;

/* 关闭弹窗（点击遮罩可关闭） */
document.getElementById('closeEx').onclick = ()=>document.getElementById('exampleModal').classList.remove('show');
document.getElementById('exampleModal').addEventListener('click', e=>{ if(e.target.id==='exampleModal') e.currentTarget.classList.remove('show'); });

document.getElementById('closeQuiz').onclick = ()=>document.getElementById('quizModal').classList.remove('show');
document.getElementById('quizModal').addEventListener('click', e=>{ if(e.target.id==='quizModal') e.currentTarget.classList.remove('show'); });

/* 标题彩蛋：连点三次标题撒花 */
let titleTap = 0;
document.getElementById('title').addEventListener('click',()=>{
  titleTap++; if(titleTap>=3){ confetti(); titleTap=0; }
});
</script>
</body>
</html>
