<!DOCTYPE html>
<html lang="zh-CN">
<head>
<link rel="manifest" href="./manifest.json" />
<meta name="theme-color" content="#0e1021" />
<link rel="apple-touch-icon" href="./icons/apple-icon-180.png" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Day11 Â· 9è¯å›åˆè®­ç»ƒï½œè¯å¡ + ä¾‹å¥ + é”™é¢˜æœ¬</title>
<style>
  :root{
    --bg:#0e1021;             /* æ·±è‰²æ¸å˜èƒŒæ™¯ */
    --bg2:#141734;
    --txt:#eaf3ff;            /* ä¸»è¦æ–‡å­— */
    --muted:#9fb2c8;          /* æ¬¡çº§æ–‡å­— */
    --card:rgba(255,255,255,.08); /* ç»ç’ƒå¡ */
    --blur:12px;
    --stroke:rgba(255,255,255,.18);
    --accent:#89b4ff;         /* ç‚¹ç¼€ */
    --accent2:#bda7ff;        /* æ¬¡ç‚¹ç¼€ */
    --ok:#9be4b5;             /* æ­£å‘è‰² */
    --warn:#ffd68d;           /* æç¤ºè‰² */
    --danger:#ff9aa2;         /* å±é™©è‰² */
  }
  html,body{height:100%}
  body{
    margin:0;
    background: radial-gradient(1200px 60% at 20% -10%, #1a2047 0%, transparent 60%),
                radial-gradient(1000px 60% at 120% 30%, #172a54 0%, transparent 50%),
                linear-gradient(180deg,var(--bg),var(--bg2));
    color:var(--txt);
    font:16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,"Noto Sans SC","PingFang SC","Hiragino Sans GB",sans-serif;
  }
  .app{max-width:1000px;margin:0 auto;padding:20px 16px 28px}
  header.head{display:flex;gap:14px;align-items:center;justify-content:space-between;flex-wrap:wrap}
  .title{display:flex;align-items:center;gap:10px}
  .title h1{font-size:20px;margin:0;font-weight:700;letter-spacing:.3px}
  .badge{font-size:12px;padding:4px 8px;border:1px solid var(--stroke);border-radius:999px;background:rgba(255,255,255,.05);color:var(--muted)}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  .btn{appearance:none;border:1px solid var(--stroke);background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.05));
       color:var(--txt);padding:8px 12px;border-radius:10px;font-size:14px;cursor:pointer;backdrop-filter:blur(var(--blur));
       transition:.2s;display:inline-flex;align-items:center;gap:8px}
  .btn:hover{transform:translateY(-1px);box-shadow:0 10px 24px -16px rgba(0,0,0,.6)}
  .btn[disabled]{opacity:.5;cursor:not-allowed}
  .btn.primary{border-color:rgba(137,180,255,.4);box-shadow:inset 0 0 0 1px rgba(137,180,255,.28)}
  .btn.ghost{background:transparent}
  .tabs{margin-top:14px;display:flex;gap:10px;flex-wrap:wrap}
  .tabs .tab{padding:6px 12px;border:1px solid var(--stroke);border-radius:999px;font-size:13px;color:var(--muted);cursor:pointer}
  .tabs .tab.active{color:var(--txt);border-color:rgba(137,180,255,.45);box-shadow:inset 0 0 0 1px rgba(137,180,255,.25)}

  /* ç½‘æ ¼å¡ç‰‡ */
  .grid{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:14px}
  @media (max-width:760px){.grid{grid-template-columns:repeat(2,1fr)}}
  @media (max-width:520px){.grid{grid-template-columns:1fr}}
  .card{position:relative;padding:16px;border-radius:16px;background:linear-gradient(180deg,rgba(255,255,255,.1),rgba(255,255,255,.06));
        border:1px solid var(--stroke);backdrop-filter:blur(var(--blur));min-height:120px;display:flex;flex-direction:column;gap:8px}
  .term{font-size:20px;font-weight:800;letter-spacing:.2px;margin:6px 0}
  .cn{color:var(--ok);font-size:15px;display:none}
  .cn.show{display:block}
  .meta{font-size:12px;color:var(--muted)}
  .toolbar{position:absolute;top:8px;right:8px;display:flex;gap:6px}
  .iconbtn{border:1px solid var(--stroke);background:rgba(255,255,255,.04);width:34px;height:32px;border-radius:9px;
           display:grid;place-items:center;color:var(--muted);cursor:pointer}
  .iconbtn.active{color:var(--accent);box-shadow:inset 0 0 0 1px rgba(137,180,255,.4)}
  .iconbtn:hover{transform:translateY(-1px)}

  /* ä¾‹å¥åŒºåŸŸ */
  .sentences{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
  .sentence{padding:16px 16px;border-radius:14px;background:linear-gradient(180deg,rgba(255,255,255,.1),rgba(255,255,255,.06));
            border:1px solid var(--stroke);backdrop-filter:blur(var(--blur));}
  .en{font-weight:700}
  .zh{display:none;color:var(--ok)}
  .zh.show{display:block;margin-top:6px}

  footer.foot{margin-top:16px;display:flex;gap:10px;align-items:center;justify-content:space-between;color:var(--muted)}
  .meter{height:8px;background:rgba(255,255,255,.08);border-radius:999px;overflow:hidden;flex:1}
  .bar{height:100%;background:linear-gradient(90deg,var(--accent),var(--accent2));width:0%}

  /* æ¨¡æ€å±‚ */
  .modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(10,12,20,.55);backdrop-filter:blur(6px);z-index:40}
  .modal.show{display:grid}
  .dialog{width:min(720px,92vw);background:linear-gradient(180deg,rgba(255,255,255,.12),rgba(255,255,255,.06));
          border:1px solid var(--stroke);border-radius:16px;padding:18px}

  /* è¿·ä½ å½©çº¸ */
  .burst{position:fixed;pointer-events:none;inset:0;overflow:hidden;z-index:60}
  .piece{position:absolute;width:8px;height:12px;opacity:0;animation:pop 1s ease-out forwards}
  @keyframes pop{0%{transform:translate(var(--x),var(--y)) rotate(0) scale(.8);opacity:1}
                 100%{transform:translate(var(--x2),var(--y2)) rotate(720deg) scale(1);opacity:0}}

  .hint{font-size:12px;color:var(--muted)}
</style>
</head>
<body>
  <div class="app">
    <header class="head">
      <div class="title" id="title">
        <span class="badge">Day11</span>
        <h1>9è¯å›åˆè®­ç»ƒ Â· è¯å¡ â†” ä¾‹å¥ Â· é”™é¢˜æœ¬</h1>
      </div>
      <div class="controls">
        <button class="btn" id="prevBtn">â† ä¸Šä¸€å›åˆ</button>
        <button class="btn primary" id="toggleViewBtn">åˆ‡æ¢åˆ°ä¾‹å¥é¡µ</button>
        <button class="btn" id="nextBtn">ä¸‹ä¸€å›åˆ â†’</button>
        <button class="btn ghost" id="showAllBtn">æ˜¾ç¤ºå…¨éƒ¨è¯‘æ–‡</button>
        <button class="btn ghost" id="hideAllBtn">éšè—å…¨éƒ¨è¯‘æ–‡</button>
        <button class="btn" id="shuffleBtn">éšæœºé¡ºåº</button>
        <button class="btn" id="wrongTabBtn">é”™é¢˜æœ¬</button>
        <button class="btn" id="deckTabBtn" style="display:none">è¿”å›è¯åº“</button>
        <button class="btn" id="miniGameBtn">ğŸ® ç¿»è¯‘æŒ‘æˆ˜</button>
        <button class="btn ghost" id="eggBtn" title="å°æƒŠå–œ">ğŸ</button>
      </div>
      <div class="hint">æç¤ºï¼šç‚¹å‡»å•è¯å³å¯<span style="color:var(--ok)">å‘éŸ³ + æ˜¾ç¤ºç¿»è¯‘</span>ï¼›ğŸ“Œå›¾é’‰åŠ å…¥é”™é¢˜æœ¬ï¼›ğŸ’¬æŸ¥çœ‹ä¾‹å¥ã€‚</div>
    </header>

    <section id="wordsView">
      <div class="grid" id="grid"></div>
    </section>

    <section id="sentencesView" style="display:none">
      <div class="controls" style="margin-top:4px">
        <button class="btn" id="shuffleSentBtn">æ¢ä¸€ç»„ä¾‹å¥</button>
        <button class="btn ghost" id="showAllZhSent">æ˜¾ç¤ºå…¨éƒ¨è¯‘æ–‡</button>
        <button class="btn ghost" id="hideAllZhSent">éšè—å…¨éƒ¨è¯‘æ–‡</button>
      </div>
      <div class="sentences" id="sentences"></div>
    </section>

    <footer class="foot">
      <div id="status">å›åˆ <span id="roundIdx">1</span>/<span id="roundTotal">1</span> Â· æœ¬å›åˆè¯æ•° <span id="roundCount">0</span> Â· é”™é¢˜æœ¬ <span id="wrongCount">0</span></div>
      <div class="meter"><div class="bar" id="bar"></div></div>
    </footer>
  </div>

  <!-- ä¾‹å¥å¼¹çª— -->
  <div class="modal" id="exampleModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <h3 id="exTitle" style="margin:0">ä¾‹å¥</h3>
        <button class="btn" id="closeEx">å…³é—­</button>
      </div>
      <div style="margin-top:10px" id="exContent"></div>
    </div>
  </div>

  <!-- è¿·ä½ æŒ‘æˆ˜å¼¹çª— -->
  <div class="modal" id="quizModal" aria-hidden="true">
    <div class="dialog">
      <div style="display:flex;justify-content:space-between;align-items:center;gap:8px">
        <h3 style="margin:0">ğŸ¯ ç¿»è¯‘æŒ‘æˆ˜ï¼ˆè¾“å…¥ä¸­æ–‡ä¹‰ï¼‰</h3>
        <button class="btn" id="closeQuiz">å…³é—­</button>
      </div>
      <div id="quizWrap" style="margin-top:12px"></div>
    </div>
  </div>

  <div class="burst" id="burst"></div>

<script>
// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” æ•°æ®åŒºï¼šè¯åº“ï¼ˆå”¯ä¸€è¯æ¡ï¼‰ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const base = [
  // æ¯é¡¹: term, cn, example.en, example.zh
  {t:'replace', cn:'æ›¿æ¢ï¼›æ›´æ¢', ex:['Please replace the old battery to prevent a shutdown during the presentation.','è¯·æ›´æ¢æ—§ç”µæ± ï¼Œä»¥é˜²åœ¨æ¼”ç¤ºæ—¶å…³æœºã€‚']},
  {t:'favorable', cn:'æœ‰åˆ©çš„ï¼›æœ‰å¥½æ„Ÿçš„', ex:['The survey results were favorable, so the committee approved the expansion.','è°ƒæŸ¥ç»“æœæ˜¯æœ‰åˆ©çš„ï¼Œå› æ­¤å§”å‘˜ä¼šæ‰¹å‡†äº†æ‰©å»ºã€‚']},
  {t:'addition', cn:'å¢åŠ ï¼›å¦å¤–ï¼›é™„åŠ ç‰©', ex:['In addition to salary, the company offers a reward for innovation.','é™¤äº†è–ªèµ„ï¼Œå…¬å¸è¿˜ä¸ºåˆ›æ–°æä¾›å¥–åŠ±ã€‚']},
  {t:'exist', cn:'å­˜åœ¨', ex:['Some problems still exist despite repeated checks.','å°½ç®¡åå¤æ£€æŸ¥ï¼Œä»ç„¶å­˜åœ¨ä¸€äº›é—®é¢˜ã€‚']},

  {t:'position', cn:'ä½ç½®ï¼›èŒä½ï¼›ç«‹åœº', ex:['Her position combines teaching and research, and she is recognized as a major figure in the department.','å¥¹çš„èŒä½å…¼å…·æ•™å­¦ä¸ç§‘ç ”ï¼Œå¹¶è¢«è®¤ä¸ºæ˜¯è¯¥ç³»çš„é‡è¦äººç‰©ã€‚']},
  {t:'recommend', cn:'æ¨èï¼›å»ºè®®', ex:['Doctors often recommend regular exercise to reduce stress.','åŒ»ç”Ÿå¸¸å»ºè®®è§„å¾‹è¿åŠ¨ä»¥ç¼“è§£å‹åŠ›ã€‚']},
  {t:'tip', cn:'æç¤ºï¼›çªé—¨ï¼›å°è´¹', ex:['Quick tip: separate big goals into small steps to make sense of the process.','å°æç¤ºï¼šæŠŠå¤§ç›®æ ‡æ‹†æˆå°æ­¥éª¤ï¼Œè¿™æ ·æ›´è®²å¾—é€šã€‚']},
  {t:'affect', cn:'å½±å“ï¼ˆåŠ¨è¯ï¼‰', ex:['Lack of sleep can affect memory and energy during lectures.','ç¡çœ ä¸è¶³ä¼šå½±å“ä¸Šè¯¾æ—¶çš„è®°å¿†ä¸ç²¾åŠ›ã€‚']},

  {t:'lecture', cn:'è®²åº§ï¼›æˆè¯¾', ex:['The professor\'s lecture on contemporary art drew a local crowd despite the rain.','å°½ç®¡ä¸‹é›¨ï¼Œè¿™ä½æ•™æˆå…³äºå½“ä»£è‰ºæœ¯çš„è®²åº§ä»å¸å¼•äº†æœ¬åœ°å¬ä¼—ã€‚']},
  {t:'content', cn:'å†…å®¹ï¼›ï¼ˆå½¢å®¹è¯ï¼‰æ»¡æ„çš„', ex:['Please check whether the content of your presentation matches the procedure.','è¯·æ£€æŸ¥ä½ çš„æ¼”ç¤ºå†…å®¹æ˜¯å¦ç¬¦åˆæµç¨‹ã€‚']},
  {t:'tend', cn:'å€¾å‘äºï¼›ç…§æ–™', ex:['People tend to rely on shortcuts, but real progress requires consistency.','äººä»¬å¾€å¾€ä¾èµ–æ·å¾„ï¼Œä½†çœŸæ­£çš„è¿›æ­¥éœ€è¦åšæŒã€‚']},
  {t:'affection', cn:'å–œçˆ±ï¼›æ„Ÿæƒ…', ex:['He showed deep affection and respect for his grandmother at the memorial.','åœ¨è¿½æ€ä¼šä¸Šï¼Œä»–è¡¨è¾¾äº†å¯¹ç¥–æ¯æ·±åˆ‡çš„çˆ±ä¸å°Šé‡ã€‚']},

  {t:'favor', cn:'åçˆ±ï¼›æ©æƒ ï¼›å¸®å¿™', ex:['Could you do me a favor and confirm the entrance time?','èƒ½å¸®ä¸ªå¿™ç¡®è®¤ä¸€ä¸‹è¿›é—¨æ—¶é—´å—ï¼Ÿ']},
  {t:'prevent', cn:'é˜²æ­¢ï¼›é˜»æ­¢', ex:['Use strong passwords to prevent people from trying to steal your data.','ä½¿ç”¨å¼ºå¯†ç ä»¥é˜²ä»–äººè¯•å›¾å·å–ä½ çš„æ•°æ®ã€‚']},
  {t:'coverage', cn:'è¦†ç›–èŒƒå›´ï¼›æ–°é—»æŠ¥é“', ex:['The news coverage praised the charity\'s donation and impact.','æ–°é—»æŠ¥é“èµæ‰¬äº†è¯¥æ…ˆå–„æœºæ„çš„æèµ åŠå…¶å½±å“ã€‚']},
  {t:'presentation', cn:'æ¼”ç¤ºï¼›æŠ¥å‘Š', ex:['Her presentation was clear and concise, and the audience responded with praise.','å¥¹çš„æ¼”ç¤ºæ¸…æ™°ç®€æ´ï¼Œè§‚ä¼—ä»¥ç§°èµå›åº”ã€‚']},

  {t:'attractive', cn:'æœ‰å¸å¼•åŠ›çš„', ex:['The setting was simple but attractive, reflecting honesty and warmth.','åœºæ™¯ç®€å•å´å¸å¼•äººï¼Œæµéœ²å‡ºè¯šæ³ä¸æ¸©æš–ã€‚']},
  {t:'limit', cn:'é™åˆ¶ï¼›é™åº¦', ex:['To stay focused, set a time limit and avoid unnecessary bother.','ä¸ºä¿æŒä¸“æ³¨ï¼Œè¯·è®¾å®šæ—¶é—´é™åˆ¶å¹¶é¿å…æ— è°“æ‰“æ‰°ã€‚']},
  {t:'respect', cn:'å°Šé‡ï¼›æ–¹é¢', ex:['We respect different opinions, even when they contrast with our own.','å³ä½¿ä¸æˆ‘ä»¬ä¸åŒï¼Œæˆ‘ä»¬ä¹Ÿå°Šé‡ä»–äººçš„è§‚ç‚¹ã€‚']},
  {t:'figure', cn:'æ•°å­—ï¼›äººç‰©ï¼›èº«æï¼›è®¤ä¸º', ex:['According to the survey, the unemployment figure fell after the expansion.','è°ƒæŸ¥æ˜¾ç¤ºï¼Œæ‰©å»ºåå¤±ä¸šæ•°å­—ä¸‹é™äº†ã€‚']},

  {t:'pose', cn:'é€ æˆï¼›æ„æˆï¼›æ‘†å§¿åŠ¿', ex:['Heavy traffic can pose a safety concern for local residents.','è½¦æµé‡è¿‡å¤§ä¼šç»™å½“åœ°å±…æ°‘å¸¦æ¥å®‰å…¨éšæ‚£ã€‚']},
  {t:'major', cn:'ä¸»è¦çš„ï¼›é‡å¤§çš„ï¼›ä¸»ä¿®', ex:['A major reduction in costs made the project affordable.','æˆæœ¬çš„å¤§å¹…ä¸‹é™ä½¿é¡¹ç›®è´Ÿæ‹…å¾—èµ·ã€‚']},
  {t:'stress', cn:'å‹åŠ›ï¼›å¼ºè°ƒ', ex:['Short breaks during study can reduce stress and improve memory.','å­¦ä¹ é—´éš™çš„çŸ­æš‚ä¼‘æ¯å¯å‡å‹å¹¶æå‡è®°å¿†åŠ›ã€‚']},
  {t:'desire', cn:'æ¸´æœ›ï¼›æ¬²æœ›', ex:['She had a strong desire to produce meaningful work.','å¥¹å¼ºçƒˆæ¸´æœ›åˆ›ä½œæœ‰æ„ä¹‰çš„ä½œå“ã€‚']},

  {t:'select', cn:'é€‰æ‹©', ex:['Please select nine words per page to begin this round.','æ¯é¡µé€‰æ‹©ä¹ä¸ªå•è¯å¼€å§‹æœ¬å›åˆã€‚']},
  {t:'memory', cn:'è®°å¿†ï¼›å›å¿†', ex:['Spaced repetition strengthens memory despite early difficulty.','å°½ç®¡åˆæœŸå›°éš¾ï¼Œé—´éš”å¤ä¹ èƒ½å¢å¼ºè®°å¿†ã€‚']},
  {t:'energy', cn:'èƒ½é‡ï¼›ç²¾åŠ›', ex:['A short walk can restore energy and improve your mood.','çŸ­æš‚æ•£æ­¥èƒ½æ¢å¤ç²¾åŠ›å¹¶æ”¹å–„å¿ƒæƒ…ã€‚']},
  {t:'annoy', cn:'ä½¿æ¼æ€’', ex:['Loud notifications annoy everyone during lecturesâ€”please mute your phone.','ä¸Šè¯¾æ—¶å¤§å£°æç¤ºéŸ³ä¼šæƒ¹æ¼æ‰€æœ‰äººâ€”â€”è¯·é™éŸ³æ‰‹æœºã€‚']},

  {t:'reflect', cn:'åæ˜ ï¼›åå°„ï¼›æ·±æ€', ex:['Take five minutes to reflect and assess your progress.','èŠ±äº”åˆ†é’Ÿåæ€å¹¶è¯„ä¼°ä½ çš„è¿›åº¦ã€‚']},
  {t:'memorial', cn:'çºªå¿µç‰©ï¼›çºªå¿µé¦†', ex:['The new memorial honors local heroes and their honesty.','æ–°çš„çºªå¿µç¢‘çºªå¿µç€æœ¬åœ°è‹±é›„ä¸ä»–ä»¬çš„è¯šå®ã€‚']},
  {t:'reward', cn:'å¥–åŠ±ï¼›å›æŠ¥', ex:['We set small rewards to reduce hesitation and keep going.','è®¾ç½®å°å¥–åŠ±èƒ½å‡å°‘çŠ¹è±«å¹¶ä¿ƒä½¿åšæŒã€‚']},
  {t:'container', cn:'å®¹å™¨', ex:['Please put the devices into the labeled container after class.','ä¸‹è¯¾åè¯·æŠŠè®¾å¤‡æ”¾å…¥æ ‡æœ‰æ ‡ç­¾çš„å®¹å™¨ä¸­ã€‚']},

  {t:'relation', cn:'å…³ç³»ï¼›è”ç³»', ex:['There is a close relation between appetite and energy.','é£Ÿæ¬²ä¸ç²¾åŠ›ä¹‹é—´å…³ç³»å¯†åˆ‡ã€‚']},
  {t:'persuade', cn:'è¯´æœ', ex:['Data can persuade the committee to approve the procedure.','æ•°æ®èƒ½è¯´æœå§”å‘˜ä¼šæ‰¹å‡†è¯¥æµç¨‹ã€‚']},
  {t:'inspiration', cn:'çµæ„Ÿ', ex:['Travel often brings inspiration and fresh content for writing.','æ—…è¡Œå¸¸ä¼šå¸¦æ¥çµæ„Ÿä¸æ–°é²œçš„å†™ä½œç´ æã€‚']},
  {t:'praise', cn:'èµæ‰¬', ex:['Teachers praise students who respond clearly and honestly.','è€å¸ˆä¼šèµæ‰¬å›åº”æ¸…æ™°ä¸”è¯šæ³çš„å­¦ç”Ÿã€‚']},

  {t:'settle', cn:'è§£å†³ï¼›å®šå±…ï¼›å®‰é¡¿', ex:['Let\'s settle the schedule first and assign tasks.','å…ˆæŠŠæ—¥ç¨‹å®šä¸‹æ¥ï¼Œå†åˆ†é…ä»»åŠ¡ã€‚']},
  {t:'involve', cn:'æ¶‰åŠï¼›åŒ…å«ï¼›ç‰µæ¶‰', ex:['The plan will involve a survey and a short presentation.','è¯¥è®¡åˆ’å°†åŒ…å«ä¸€æ¬¡è°ƒç ”å’Œä¸€ä¸ªç®€çŸ­æ¼”ç¤ºã€‚']},
  {t:'regard', cn:'çœ‹å¾…ï¼›é—®å€™ï¼ˆå¤æ•°ï¼šregardsï¼‰', ex:['With regard to safety, follow the directions at the entrance.','å…³äºå®‰å…¨ï¼Œè¯·éµå¾ªå…¥å£å¤„çš„æŒ‡ç¤ºã€‚']},
  {t:'appetite', cn:'é£Ÿæ¬²ï¼›æ¸´æœ›', ex:['Regular exercise can boost your appetite and reduce stress.','è§„å¾‹è¿åŠ¨èƒ½å¢å¼ºé£Ÿæ¬²å¹¶å‡è½»å‹åŠ›ã€‚']},

  {t:'reliance', cn:'ä¾èµ–ï¼›ä¿¡èµ–', ex:['Too much reliance on one source may limit your perspective.','è¿‡åº¦ä¾èµ–å•ä¸€æ¥æºä¼šé™åˆ¶ä½ çš„è§†è§’ã€‚']},
  {t:'measure', cn:'æµ‹é‡ï¼›æªæ–½', ex:['We need to measure results before we evaluate the program.','åœ¨è¯„ä¼°è¯¥é¡¹ç›®å‰ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ç»“æœè¿›è¡Œæµ‹é‡ã€‚']},
  {t:'setting', cn:'ç¯å¢ƒï¼›èƒŒæ™¯ï¼›è®¾ç½®', ex:['Change the app setting to freeze animations on low-energy devices.','åœ¨ä½ç”µé‡è®¾å¤‡ä¸Šå¯æ›´æ”¹åº”ç”¨è®¾ç½®ä»¥å†»ç»“åŠ¨ç”»ã€‚']},
  {t:'honesty', cn:'è¯šå®ï¼›æ­£ç›´', ex:['Honesty builds trust and strong connections.','è¯šå®èƒ½å»ºç«‹ä¿¡ä»»ä¸ç¨³å›ºçš„äººé™…è¿æ¥ã€‚']},

  {t:'contrast', cn:'å¯¹æ¯”ï¼›å·®å¼‚', ex:['The contrast between salary and workload raised concern.','è–ªèµ„ä¸å·¥ä½œé‡çš„åå·®å¼•å‘äº†æ‹…å¿§ã€‚']},
  {t:'local', cn:'æœ¬åœ°çš„ï¼›å½“åœ°çš„', ex:['Local residents responded to the urgent call for donation.','å½“åœ°å±…æ°‘å¯¹ç´§æ€¥å‹Ÿæè¿…é€Ÿä½œå‡ºå“åº”ã€‚']},
  {t:'suspect', cn:'æ€€ç–‘ï¼›å«Œç–‘äºº', ex:['I suspect the failure happened because the container wasn\'t sealed.','æˆ‘æ€€ç–‘æ•…éšœå‘ç”Ÿçš„åŸå› æ˜¯å®¹å™¨æœªå¯†å°ã€‚']},
  {t:'integrate', cn:'æ•´åˆï¼›èå…¥', ex:['We will integrate the new feature without breaking existing content.','æˆ‘ä»¬ä¼šæ•´åˆæ–°ç‰¹æ€§ï¼ŒåŒæ—¶ä¸ç ´åç°æœ‰å†…å®¹ã€‚']},

  {t:'approve', cn:'æ‰¹å‡†ï¼›èµæˆ', ex:['The board will approve the expansion if the data make sense.','è‹¥æ•°æ®åˆç†ï¼Œè‘£äº‹ä¼šå°†æ‰¹å‡†æ‰©å»ºã€‚']},
  {t:'freeze', cn:'å†»ç»“ï¼›ç»“å†°ï¼›å¡æ­»', ex:['If the app freezes, check the procedure and restart.','è‹¥åº”ç”¨å¡æ­»ï¼Œè¯·æ£€æŸ¥æµç¨‹å¹¶é‡å¯ã€‚']},
  {t:'independent', cn:'ç‹¬ç«‹çš„', ex:['She became financially independent after a higher salary.','è·å¾—æ›´é«˜è–ªèµ„åï¼Œå¥¹åœ¨ç»æµä¸Šå®ç°äº†ç‹¬ç«‹ã€‚']},
  {t:'hesitation', cn:'çŠ¹è±«', ex:['After a brief hesitation, he proposed a new direction.','çŸ­æš‚çŠ¹è±«åï¼Œä»–æå‡ºäº†æ–°æ–¹å‘ã€‚']},

  {t:'entrance', cn:'å…¥å£ï¼›è¿›å…¥', ex:['Please wait at the main entrance; the lecture starts at seven.','è¯·åœ¨æ­£é—¨ç­‰å¾…ï¼›è®²åº§ä¸ƒç‚¹å¼€å§‹ã€‚']},
  {t:'assign', cn:'åˆ†é…ï¼›å¸ƒç½®', ex:['Teachers assign writing that reflects local issues.','è€å¸ˆä¼šå¸ƒç½®åæ˜ æœ¬åœ°é—®é¢˜çš„å†™ä½œä»»åŠ¡ã€‚']},
  {t:'expansion', cn:'æ‰©å¼ ï¼›æ‰©å»º', ex:['The library expansion includes a memorial and a new lecture hall.','å›¾ä¹¦é¦†æ‰©å»ºåŒ…å«ä¸€å¤„çºªå¿µç¢‘å’Œä¸€é—´æ–°è®²å ‚ã€‚']},
  {t:'bother', cn:'æ‰“æ‰°ï¼›çƒ¦æ¼', ex:['Don\'t bother with rumors; confirm facts through a survey.','åˆ«è¢«æµè¨€æ‰“æ‰°ï¼›ç”¨è°ƒæŸ¥æ¥æ ¸å®äº‹å®ã€‚']},

  {t:'afford', cn:'ä¹°å¾—èµ·ï¼›è´Ÿæ‹…å¾—èµ·', ex:['We can\'t afford delays on this urgent procedure.','è¿™é¡¹ç´§æ€¥æµç¨‹ç»ä¸èµ·å»¶è¯¯ã€‚']},
  {t:'giant', cn:'å·¨å¤§çš„ï¼›å·¨å¤´', ex:['Several tech giants were recognized as leaders in contemporary AI.','å¤šå®¶ç§‘æŠ€å·¨å¤´è¢«è§†ä¸ºå½“ä»£äººå·¥æ™ºèƒ½é¢†åŸŸçš„é¢†å†›è€…ã€‚']},
  {t:'string', cn:'ç»†ç»³ï¼›å­—ç¬¦ä¸²', ex:['Use a strong string to tie the container before transport.','è¿è¾“å‰ç”¨ç‰¢å›ºçš„ç»†ç»³æ†å¥½å®¹å™¨ã€‚']},
  {t:'accompanied', cn:'é™ªåŒçš„ï¼›ä¼´éšçš„ï¼ˆaccompanied byï¼‰', ex:['She arrived accompanied by a local guide who knew every entrance.','å¥¹åœ¨ä¸€ä½ç†Ÿæ‚‰å„ä¸ªå…¥å£çš„æœ¬åœ°å‘å¯¼é™ªåŒä¸‹åˆ°è¾¾ã€‚']},

  {t:'quantity', cn:'æ•°é‡', ex:['Limit sugar quantity to maintain energy and appetite.','é™åˆ¶ç³–çš„æ‘„å…¥é‡ä»¥ç»´æŒç²¾åŠ›ä¸é£Ÿæ¬²ã€‚']},
  {t:'salary', cn:'è–ªæ°´', ex:['They negotiated a higher salary despite a reduction plan.','å°½ç®¡å…¬å¸æœ‰ç¼©å‡è®¡åˆ’ï¼Œä»–ä»¬ä»è°ˆä¸‹äº†æ›´é«˜è–ªèµ„ã€‚']},
  {t:'assess', cn:'è¯„ä¼°', ex:['We assess each student independently to ensure fairness.','æˆ‘ä»¬ç‹¬ç«‹è¯„ä¼°æ¯ä½å­¦ç”Ÿä»¥ç¡®ä¿å…¬å¹³ã€‚']},
  {t:'reduction', cn:'å‡å°‘ï¼›ç¼©å‡', ex:['The reduction in noise will prevent annoyance during study.','å™ªéŸ³çš„å‡å°‘å°†é˜²æ­¢å­¦ä¹ æ—¶çš„çƒ¦èºã€‚']},

  {t:'separate', cn:'åˆ†å¼€ï¼›å•ç‹¬çš„', ex:['Please separate the words into rounds and assign them.','è¯·æŠŠå•è¯åˆ†æˆè‹¥å¹²å›åˆå¹¶è¿›è¡Œåˆ†é…ã€‚']},
  {t:'check', cn:'æ£€æŸ¥ï¼›æ ¸å¯¹ï¼›æ”¯ç¥¨', ex:['Double-check the figures before the presentation.','æ¼”ç¤ºå‰è¯·å†æ¬¡æ ¸å¯¹æ•°æ®ã€‚']},
  {t:'identify', cn:'è¯†åˆ«ï¼›ç¡®è®¤', ex:['Can you identify the main concern in this procedure?','ä½ èƒ½è¯†åˆ«å‡ºè¯¥æµç¨‹ä¸­çš„ä¸»è¦é—®é¢˜å—ï¼Ÿ']},
  {t:'make sense', cn:'æœ‰é“ç†ï¼›è®²å¾—é€š', ex:['Your explanation makes sense despite limited coverage.','å°½ç®¡è¦†ç›–æœ‰é™ï¼Œä½ çš„è§£é‡Šä»ç„¶è¯´å¾—é€šã€‚']},

  {t:'contain', cn:'åŒ…å«ï¼›å®¹çº³', ex:['Does this container contain any chemical products?','è¿™ä¸ªå®¹å™¨é‡Œæ˜¯å¦åŒ…å«ä»»ä½•åŒ–å­¦å“ï¼Ÿ']},
  {t:'steal', cn:'å·çªƒ', ex:['The suspect tried to steal phones near the entrance.','å«Œç–‘äººè¯•å›¾åœ¨å…¥å£é™„è¿‘å·æ‰‹æœºã€‚']},
  {t:'confirm', cn:'ç¡®è®¤', ex:['Please confirm the survey time with the local team.','è¯·ä¸æœ¬åœ°å›¢é˜Ÿç¡®è®¤è°ƒç ”æ—¶é—´ã€‚']},
  {t:'charity', cn:'æ…ˆå–„ï¼›æ…ˆå–„æœºæ„', ex:['The charity organized a donation to support education.','è¯¥æ…ˆå–„æœºæ„ç»„ç»‡äº†ææ¬¾ä»¥æ”¯æŒæ•™è‚²ã€‚']},

  {t:'produce', cn:'ç”Ÿäº§ï¼›å‡ºäº§ï¼›å†œäº§å“', ex:['Local farms produce fresh vegetables in large quantities.','å½“åœ°å†œåœºå¤§é‡å‡ºäº§æ–°é²œè”¬èœã€‚']},
  {t:'fortunate', cn:'å¹¸è¿çš„', ex:['We are fortunate to have independent experts supporting us.','æˆ‘ä»¬å¾ˆå¹¸è¿èƒ½å¾—åˆ°ç‹¬ç«‹ä¸“å®¶çš„æ”¯æŒã€‚']},
  {t:'be recognized as', cn:'è¢«è®¤ä¸ºæ˜¯ï¼›è¢«å…¬è®¤ä¸º', ex:['She was recognized as a major figure after the presentation.','é‚£æ¬¡æ¼”ç¤ºåï¼Œå¥¹è¢«å…¬è®¤ä¸ºé‡è¦äººç‰©ã€‚']},
  {t:'evaluate', cn:'è¯„ä¼°ï¼›è¯„ä»·', ex:['Before expansion, we must evaluate costs and benefits.','æ‰©å»ºå‰æˆ‘ä»¬å¿…é¡»è¯„ä¼°æˆæœ¬ä¸æ”¶ç›Šã€‚']},

  {t:'urgent', cn:'ç´§æ€¥çš„', ex:['This is an urgent messageâ€”please respond soon.','è¿™æ˜¯ä¸€æ¡ç´§æ€¥ä¿¡æ¯â€”â€”è¯·å°½å¿«å›å¤ã€‚']},
  {t:'direction', cn:'æ–¹å‘ï¼›æŒ‡ç¤ºï¼›è¯´æ˜', ex:['Follow the safety directions posted by the entrance.','éµå¾ªå…¥å£å¤„å¼ è´´çš„å®‰å…¨æŒ‡ç¤ºã€‚']},
  {t:'survey', cn:'è°ƒæŸ¥ï¼›æµ‹é‡', ex:['The survey data reflect a strong desire for longer lectures.','è°ƒæŸ¥æ•°æ®æ˜¾ç¤ºï¼Œå¤§å®¶å¼ºçƒˆå¸Œæœ›å»¶é•¿æˆè¯¾æ—¶é—´ã€‚']},
  {t:'require', cn:'éœ€è¦ï¼›è¦æ±‚', ex:['Most procedures require patience and careful checks.','å¤§å¤šæ•°æµç¨‹éœ€è¦è€å¿ƒä¸ç»†è‡´çš„æ ¸æŸ¥ã€‚']},

  {t:'procedure', cn:'ç¨‹åºï¼›æµç¨‹ï¼›æ‰‹ç»­', ex:['The new procedure was approved after a short trial.','æ–°æµç¨‹åœ¨çŸ­æœŸè¯•è¿è¡Œåè·æ‰¹ã€‚']},
  {t:'contemporary', cn:'å½“ä»£çš„ï¼›åŒä¸€æ—¶ä»£çš„', ex:['Contemporary artists often integrate technology into their work.','å½“ä»£è‰ºæœ¯å®¶å¸¸å°†æŠ€æœ¯èå…¥ä½œå“ã€‚']},
  {t:'respond', cn:'å›ç­”ï¼›å›åº”', ex:['Please respond to the message despite being busy.','å³ä½¿å¿™ç¢Œä¹Ÿè¯·å›å¤æ­¤æ¶ˆæ¯ã€‚']},
  {t:'despite', cn:'å°½ç®¡', ex:['Despite the stress, she kept her honesty and respect.','å°½ç®¡å‹åŠ›å¾ˆå¤§ï¼Œå¥¹ä»ä¿æŒè¯šå®ä¸å°Šé‡ã€‚']},

  {t:'propose', cn:'æè®®ï¼›æ±‚å©š', ex:['I propose we select fewer features to reduce complexity.','æˆ‘å»ºè®®æˆ‘ä»¬å°‘é€‰ä¸€äº›åŠŸèƒ½ä»¥é™ä½å¤æ‚åº¦ã€‚']},
  {t:'concern', cn:'æ‹…å¿§ï¼›å…³åˆ‡ï¼›æ¶‰åŠ', ex:['Data privacy is a major concern for contemporary users.','æ•°æ®éšç§æ˜¯å½“ä»£ç”¨æˆ·çš„ä¸»è¦æ‹…å¿§ã€‚']},
  {t:'consult', cn:'å’¨è¯¢ï¼›è¯·æ•™', ex:['Consult your teacher if you suspect a mistake.','è‹¥æ€€ç–‘æœ‰è¯¯ï¼Œè¯·å’¨è¯¢è€å¸ˆã€‚']},
  {t:'feature', cn:'ç‰¹å¾ï¼›ç‰¹è‰²ï¼›ä»¥â€¦ä¸ºç‰¹è‰²', ex:['This app\'s key feature is the nine-word round.','æœ¬åº”ç”¨çš„æ ¸å¿ƒç‰¹è‰²æ˜¯â€œä¹è¯ä¸€å›åˆâ€ã€‚']},
  {t:'donation', cn:'æèµ ï¼›ææ¬¾', ex:['Their donation was small in quantity but full of affection.','ä»–ä»¬çš„æèµ æ•°é‡ä¸å¤šï¼Œå´é¥±å«çˆ±å¿ƒã€‚']},
  {t:'connection', cn:'è¿æ¥ï¼›è”ç³»', ex:['A stable internet connection is required for online lectures.','åœ¨çº¿æˆè¯¾éœ€è¦ç¨³å®šçš„ç½‘ç»œè¿æ¥ã€‚']},
];

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” æ„å»ºåŸå§‹é¡ºåºï¼ˆåŒ…å«é‡å¤ï¼‰ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
const deckOrder = [
  'replace','favorable','addition','exist',
  'position','recommend','tip','affect',
  'lecture','content','tend','affection',
  'favor','prevent','coverage','presentation',

  'attractive','limit','respect','figure',
  'pose','major','stress','desire',
  'select','memory','energy','annoy',
  'reflect','memorial','reward','container',

  'relation','persuade','inspiration','limit',
  'praise','settle','involve','reflect',
  'regard','appetite','attractive','limit',
  'reliance','measure','select','major',

  'setting','honesty','contrast','local',
  'suspect','integrate','approve','freeze',
  'independent','hesitation','entrance','assign',
  'expansion','bother','afford','giant',

  'string','accompanied','quantity','salary',
  'assess','reduction','separate','check',
  'identify','make sense','contain','steal',
  'confirm','charity','produce','fortunate',

  'be recognized as','evaluate','urgent','direction',
  'survey','require','procedure','contemporary',
  'respond','despite','propose','concern',
  'consult','feature','donation','connection',
];

// å»ºç«‹ç´¢å¼•
const map = new Map(base.map((b,i)=>[b.t,i]));
const deck = deckOrder.map(t=>base[map.get(t)]).filter(Boolean);

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” çŠ¶æ€ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
let currentRound = 0; // ä»0èµ·
const pageSize = 9;
let inSentencesView = false;
let scrambled = false;
let wrongBook = new Set(JSON.parse(localStorage.getItem('wrongBook_v1')||'[]'));

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” å·¥å…·å‡½æ•° â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function speak(text, lang='en-US'){
  try{
    const u = new SpeechSynthesisUtterance(text);
    const voices = speechSynthesis.getVoices();
    const en = voices.find(v=>/en[-_](US|GB)|English/i.test(v.lang)) || voices[0];
    if(en) u.voice = en; u.lang = en?.lang || lang; u.rate = 0.95; u.pitch = 1; u.volume = 1;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){console.warn('TTS failed:',e)}
}
function saveWrong(){ localStorage.setItem('wrongBook_v1', JSON.stringify([...wrongBook])); }
function chunk(arr, size){ const out=[]; for(let i=0;i<arr.length;i+=size) out.push(arr.slice(i,i+size)); return out; }
function randPick(arr, k){ const a=[...arr]; a.sort(()=>Math.random()-0.5); return a.slice(0, k); }
function setBar(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  if(total <= 0){ document.getElementById('bar').style.width = '0%'; return; }
  const totalRounds = Math.max(1, Math.ceil(total/pageSize));
  const pct = ((currentRound) / (totalRounds-1 || 1)) * 100;
  document.getElementById('bar').style.width = pct + '%';
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” æ¸²æŸ“ï¼šè¯å¡é¡µ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function renderWords(){
  inSentencesView = false;
  document.getElementById('wordsView').style.display='block';
  document.getElementById('sentencesView').style.display='none';
  document.getElementById('toggleViewBtn').textContent='åˆ‡æ¢åˆ°ä¾‹å¥é¡µ';

  const arr = inWrongMode ? getWrongDeck() : deck;
  const rounds = chunk(arr, pageSize);
  const totalRounds = rounds.length;
  currentRound = Math.max(0, Math.min(currentRound, Math.max(0,totalRounds-1)));
  const round = rounds[currentRound] || [];
  const g = document.getElementById('grid');
  g.innerHTML='';

  if(inWrongMode && arr.length===0){
    g.innerHTML = '<div class="card" style="border-style:dashed;opacity:.9"><div class="term">é”™é¢˜æœ¬æ˜¯ç©ºçš„</div><div class="meta">åœ¨è¯å¡é¡µç‚¹å‡»ğŸ“ŒåŠ å…¥åå†æ¥å¤ä¹ </div></div>';
    document.getElementById('roundIdx').textContent = 0;
    document.getElementById('roundTotal').textContent = 0;
    document.getElementById('roundCount').textContent = 0;
    setBar();
    return;
  }

  round.forEach(item=>{
    const card = document.createElement('div');
    card.className='card';

    const tb = document.createElement('div');
    tb.className='toolbar';

    const exBtn = document.createElement('button');
    exBtn.className='iconbtn'; exBtn.title='ä¾‹å¥'; exBtn.innerHTML='ğŸ’¬';
    exBtn.onclick = ()=>openExample(item);

    const pin = document.createElement('button');
    pin.className='iconbtn'; pin.title='åŠ å…¥/ç§»å‡ºé”™é¢˜æœ¬'; pin.innerHTML='ğŸ“Œ';
    if(wrongBook.has(item.t)) pin.classList.add('active');
    pin.onclick = ()=>{ if(wrongBook.has(item.t)) wrongBook.delete(item.t); else wrongBook.add(item.t); pin.classList.toggle('active'); saveWrong(); updateFooter(); };

    tb.appendChild(exBtn); tb.appendChild(pin);

    const term = document.createElement('div');
    term.className='term'; term.textContent = item.t;
    term.setAttribute('role','button');
    term.onclick = ()=>{ speak(item.t); cn.classList.toggle('show'); };

    const cn = document.createElement('div');
    cn.className='cn'; cn.textContent = item.cn;

    const meta = document.createElement('div');
    meta.className='meta'; meta.textContent='ç‚¹å‡»å•è¯ï¼šå‘éŸ³ + æ˜¾ç¤ºä¸­æ–‡';

    card.appendChild(tb);
    card.appendChild(term);
    card.appendChild(cn);
    card.appendChild(meta);
    g.appendChild(card);
  });

  // è¡¥ä½ï¼ˆä¸è¶³9ä¸ªï¼‰
  const remain = pageSize - round.length;
  for(let i=0;i<remain;i++){
    const ghost = document.createElement('div');
    ghost.className='card';
    ghost.style.opacity=.5; ghost.style.borderStyle='dashed';
    ghost.innerHTML='<div class="meta">ï¼ˆæœ¬å›åˆä¸è¶³ä¹ä¸ªï¼‰</div>';
    g.appendChild(ghost);
  }

  document.getElementById('roundIdx').textContent = (currentRound+1);
  document.getElementById('roundTotal').textContent = totalRounds;
  document.getElementById('roundCount').textContent = round.length;
  setBar();
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” æ¸²æŸ“ï¼šä¾‹å¥é¡µï¼ˆæœ¬å›åˆéšæœº2~3å¥ï¼‰ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function renderSentences(){
  inSentencesView = true;
  document.getElementById('wordsView').style.display='none';
  document.getElementById('sentencesView').style.display='block';
  document.getElementById('toggleViewBtn').textContent='åˆ‡æ¢åˆ°è¯å¡é¡µ';

  const arr = inWrongMode ? getWrongDeck() : deck;
  const rounds = chunk(arr, pageSize);
  const round = rounds[currentRound] || [];
  const box = document.getElementById('sentences');
  box.innerHTML='';

  if(inWrongMode && arr.length===0){
    const s = document.createElement('div'); s.className='sentence';
    s.innerHTML = '<div class="en">é”™é¢˜æœ¬æš‚æ— ä¾‹å¥</div><div class="zh show">å…ˆå›åˆ°è¯åº“é¡µæ·»åŠ ä¸€äº›ğŸ“Œå§</div>';
    box.appendChild(s);
    return;
  }

  const k = Math.min(3, Math.max(2, Math.floor(Math.random()*2)+2));
  const pick = randPick(round, Math.min(k, round.length));

  pick.forEach(item=>{
    const s = document.createElement('div'); s.className='sentence';
    const en = document.createElement('div'); en.className='en'; en.textContent=item.ex[0];
    const zh = document.createElement('div'); zh.className='zh'; zh.textContent=item.ex[1];
    s.appendChild(en); s.appendChild(zh);
    s.onclick=()=> zh.classList.toggle('show');
    box.appendChild(s);
  });
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” ä¾‹å¥å¼¹çª— â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function openExample(item){
  document.getElementById('exTitle').textContent = `ğŸ“˜ ${item.t}`;
  const c = document.getElementById('exContent');
  c.innerHTML = '';
  const en = document.createElement('div'); en.className='en'; en.textContent=item.ex[0];
  const zh = document.createElement('div'); zh.className='zh show'; zh.textContent=item.ex[1];
  const p = document.createElement('div'); p.className='hint'; p.textContent='ç‚¹å‡»è‹±æ–‡å‘éŸ³';
  en.onclick=()=>speak(item.ex[0]);
  c.appendChild(en); c.appendChild(zh); c.appendChild(p);
  document.getElementById('exampleModal').classList.add('show');
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” è¿·ä½ ç¿»è¯‘æŒ‘æˆ˜ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
let quizItem = null;
function openQuiz(){
  const rounds = chunk(deck, pageSize);
  const round = inWrongMode? chunk(getWrongDeck(), pageSize)[currentRound] || [] : rounds[currentRound] || [];
  if(round.length===0){ alert('æœ¬å›åˆæš‚æ— è¯æ¡'); return; }
  quizItem = round[Math.floor(Math.random()*round.length)];
  const wrap = document.getElementById('quizWrap');
  wrap.innerHTML = '';
  const q = document.createElement('div'); q.className='en'; q.style.marginBottom='8px'; q.textContent = `è¯·ç¿»è¯‘ï¼š${quizItem.t}`;
  const input = document.createElement('input'); input.placeholder='è¾“å…¥ä¸­æ–‡æ„æ€'; input.style.width='100%'; input.style.padding='10px'; input.style.borderRadius='10px'; input.style.border='1px solid var(--stroke)'; input.style.background='rgba(255,255,255,.06)'; input.style.color='var(--txt)';
  const bar = document.createElement('div'); bar.style.display='flex'; bar.style.gap='8px'; bar.style.marginTop='10px';
  const btn = document.createElement('button'); btn.className='btn primary'; btn.textContent='æäº¤';
  const reveal = document.createElement('button'); reveal.className='btn'; reveal.textContent='æ˜¾ç¤ºç­”æ¡ˆ';
  const addWrong = document.createElement('button'); addWrong.className='btn'; addWrong.textContent='åŠ å…¥é”™é¢˜æœ¬ ğŸ“Œ';
  bar.appendChild(btn); bar.appendChild(reveal); bar.appendChild(addWrong);
  const res = document.createElement('div'); res.className='hint'; res.style.marginTop='8px';

  btn.onclick = ()=>{
    const user = (input.value||'').trim();
    if(!user){ res.textContent='å…ˆè¾“å…¥ä½ çš„ç¿»è¯‘~'; return; }
    // å®½æ¾åˆ¤æ–­ï¼šåªè¦åŒ…å«ä»»æ„ä¸¤ä¸ªä¸­æ–‡å­—ç¬¦ä¸”ä¸ç­”æ¡ˆæœ‰äº¤é›†å°±ç»™é€šè¿‡ï¼›å¦åˆ™å±•ç¤ºç­”æ¡ˆ
    const ans = quizItem.cn.replace(/[ï¼›;ï¼Œ,ã€‚]/g,' ');
    let ok=false;
    const parts = ans.split(/\s+/).filter(Boolean);
    for(const p of parts){ if(p && user.includes(p)) { ok=true; break; } }
    if(ok){ res.textContent='âœ… ä¸é”™ï¼'; confetti(); }
    else { res.textContent='âŒ å†æƒ³æƒ³ã€‚æ­£ç¡®ç­”æ¡ˆï¼š'+quizItem.cn; }
  };
  reveal.onclick = ()=>{ res.textContent='ç­”æ¡ˆï¼š'+quizItem.cn; };
  addWrong.onclick = ()=>{ wrongBook.add(quizItem.t); saveWrong(); updateFooter(); addWrong.classList.add('active'); };

  wrap.appendChild(q); wrap.appendChild(input); wrap.appendChild(bar); wrap.appendChild(res);
  document.getElementById('quizModal').classList.add('show');
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” é”™é¢˜æœ¬è§†å›¾ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
let inWrongMode = false;
function getWrongDeck(){ return [...wrongBook].map(t=> base[map.get(t)]).filter(Boolean); }
function enterWrong(){ inWrongMode = true; document.getElementById('deckTabBtn').style.display='inline-flex'; document.getElementById('wrongTabBtn').style.display='none'; currentRound=0; renderWords(); updateFooter(); }
function leaveWrong(){ inWrongMode = false; document.getElementById('deckTabBtn').style.display='none'; document.getElementById('wrongTabBtn').style.display='inline-flex'; currentRound=0; renderWords(); updateFooter(); }

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” èåˆï¼šä¸Šä¸€/ä¸‹ä¸€å›åˆã€éšæœºé¡ºåºã€æ˜¾ç¤ºå…¨éƒ¨/éšè—å…¨éƒ¨ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function showAllCN(){ document.querySelectorAll('#grid .cn').forEach(el=>el.classList.add('show')); }
function hideAllCN(){ document.querySelectorAll('#grid .cn').forEach(el=>el.classList.remove('show')); }
function showAllZh(){ document.querySelectorAll('#sentences .zh').forEach(el=>el.classList.add('show')); }
function hideAllZh(){ document.querySelectorAll('#sentences .zh').forEach(el=>el.classList.remove('show')); }

function updateFooter(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  let rounds = Math.ceil(total/pageSize);
  const wrongCount = wrongBook.size; document.getElementById('wrongCount').textContent = wrongCount;

  if(inWrongMode && total===0){
    document.getElementById('roundTotal').textContent = 0;
    document.getElementById('roundIdx').textContent = 0;
    document.getElementById('roundCount').textContent = 0;
    setBar();
    return;
  }

  rounds = Math.max(1, rounds);
  document.getElementById('roundTotal').textContent = rounds;
  const roundArr = inWrongMode ? chunk(getWrongDeck(), pageSize)[currentRound] || [] : chunk(deck, pageSize)[currentRound] || [];
  document.getElementById('roundCount').textContent = roundArr.length;
  document.getElementById('roundIdx').textContent = (currentRound+1);
  setBar();
}

function prevRound(){ if(currentRound>0){ currentRound--; renderCurrent(); } }
function nextRound(){
  const total = inWrongMode ? getWrongDeck().length : deck.length;
  const rounds = Math.ceil(total/pageSize);
  if(currentRound < rounds-1){ currentRound++; renderCurrent(); }
}
function renderCurrent(){ if(inSentencesView) renderSentences(); else renderWords(); updateFooter(); }
function toggleView(){ inSentencesView? renderWords() : renderSentences(); }

function shuffleDeck(){
  scrambled = !scrambled;
  const arr = inWrongMode ? getWrongDeck() : deck;
  if(scrambled){ arr.sort(()=>Math.random()-0.5); } else { // æ¢å¤åŸé¡ºåº
    if(inWrongMode){ /* é”™é¢˜æœ¬æ— åŸé¡ºåºï¼Œå¿½ç•¥ */ }
    else {
      // é‡å»º deck ä¸ºåŸå§‹é¡ºåº
      while(deck.length) deck.pop();
      deckOrder.forEach(t=> deck.push(base[map.get(t)]));
    }
  }
  currentRound=0; renderCurrent();
}

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” å°æƒŠå–œï¼ˆå½©çº¸ï¼‰ â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
function confetti(){
  const b = document.getElementById('burst');
  for(let i=0;i<32;i++){
    const p=document.createElement('div'); p.className='piece';
    const x = (window.innerWidth/2)+'px'; const y = '20%';
    const x2 = (Math.random()*100)+'vw'; const y2 = (60+Math.random()*40)+'vh';
    p.style.setProperty('--x', x); p.style.setProperty('--y', y); p.style.setProperty('--x2', x2); p.style.setProperty('--y2', y2);
    p.style.background = `linear-gradient(${Math.random()*360}deg, var(--accent), var(--accent2))`;
    p.style.left = (window.innerWidth/2)+'px'; p.style.top='10%';
    b.appendChild(p); setTimeout(()=>p.remove(), 1000);
  }
}
let titleTap=0; document.getElementById('title').addEventListener('click',()=>{ titleTap++; if(titleTap>=3){ confetti(); titleTap=0; }});

// â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” äº‹ä»¶ç»‘å®š â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”
window.addEventListener('load', ()=>{ renderWords(); updateFooter(); setTimeout(()=>speechSynthesis.getVoices(), 300); });

document.getElementById('prevBtn').onclick = prevRound;
document.getElementById('nextBtn').onclick = nextRound;
document.getElementById('toggleViewBtn').onclick = toggleView;
document.getElementById('showAllBtn').onclick = showAllCN;
document.getElementById('hideAllBtn').onclick = hideAllCN;
document.getElementById('shuffleBtn').onclick = shuffleDeck;
document.getElementById('wrongTabBtn').onclick = enterWrong;
document.getElementById('deckTabBtn').onclick = leaveWrong;
document.getElementById('miniGameBtn').onclick = openQuiz;
document.getElementById('eggBtn').onclick = confetti;

document.getElementById('shuffleSentBtn').onclick = renderSentences;
document.getElementById('showAllZhSent').onclick = showAllZh;
document.getElementById('hideAllZhSent').onclick = hideAllZh;

document.getElementById('closeEx').onclick = ()=>document.getElementById('exampleModal').classList.remove('show');
document.getElementById('exampleModal').addEventListener('click', e=>{ if(e.target.id==='exampleModal') e.currentTarget.classList.remove('show'); });

document.getElementById('closeQuiz').onclick = ()=>document.getElementById('quizModal').classList.remove('show');
document.getElementById('quizModal').addEventListener('click', e=>{ if(e.target.id==='quizModal') e.currentTarget.classList.remove('show'); });
</script>
</body>
</html>

