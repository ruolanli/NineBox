<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>è¥¿æ¸¸è®°äººç‰©å¿—ï½œæ¸…æ–°è“ç»¿é£</title>

  <style>
    :root{
      --bg1:#e8fbf7;
      --bg2:#e6f4ff;
      --card:#ffffffcc;
      --card2:#ffffffef;
      --text:#12343b;
      --muted:#4a6b73;
      --brand:#13b7a6;
      --brand2:#2aa5ff;
      --line:#d3ece8;
      --shadow: 0 14px 40px rgba(18, 52, 59, .12);
      --shadow2: 0 8px 22px rgba(18, 52, 59, .10);
      --radius: 18px;
    }

    [data-theme="dark"]{
      --bg1:#061a1c;
      --bg2:#06121c;
      --card:#0b2327cc;
      --card2:#0b2327f0;
      --text:#e6ffff;
      --muted:#b3d6d6;
      --brand:#18d2be;
      --brand2:#5fb3ff;
      --line:#143a40;
      --shadow: 0 18px 60px rgba(0, 0, 0, .35);
      --shadow2: 0 10px 30px rgba(0, 0, 0, .28);
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      color:var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, "PingFang SC","Microsoft YaHei", Arial;
      background:
        radial-gradient(1200px 700px at 10% 10%, rgba(19,183,166,.25), transparent 55%),
        radial-gradient(1000px 600px at 90% 30%, rgba(42,165,255,.22), transparent 60%),
        linear-gradient(135deg, var(--bg1), var(--bg2));
      min-height:100vh;
      overflow-x:hidden;
    }

    /* èƒŒæ™¯æ³¢çº¹è£…é¥° */
    .waves{
      position:fixed; inset:-120px -140px auto auto;
      width:520px; height:520px;
      background: radial-gradient(circle at center, rgba(19,183,166,.15), transparent 55%);
      filter: blur(0px);
      border-radius: 50%;
      pointer-events:none;
      animation: float 10s ease-in-out infinite;
      mix-blend-mode: multiply;
      opacity:.9;
    }
    .waves:after{
      content:"";
      position:absolute; inset:60px;
      background: radial-gradient(circle at center, rgba(42,165,255,.16), transparent 60%);
      border-radius: 50%;
      animation: float2 12s ease-in-out infinite;
    }
    @keyframes float{
      0%,100%{transform: translate(0,0) scale(1)}
      50%{transform: translate(-14px, 16px) scale(1.03)}
    }
    @keyframes float2{
      0%,100%{transform: translate(0,0) scale(1)}
      50%{transform: translate(18px, -10px) scale(1.05)}
    }

    header{
      position:sticky; top:0; z-index:10;
      backdrop-filter: blur(10px);
      background: linear-gradient(180deg, rgba(255,255,255,.70), rgba(255,255,255,.25));
      border-bottom: 1px solid rgba(255,255,255,.35);
    }
    [data-theme="dark"] header{
      background: linear-gradient(180deg, rgba(8,22,24,.72), rgba(8,22,24,.25));
      border-bottom: 1px solid rgba(20,58,64,.6);
    }

    .wrap{max-width: 1100px; margin:0 auto; padding: 18px 18px;}
    .topbar{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
    }
    .brand{
      display:flex; align-items:center; gap:10px;
    }
    .logo{
      width:44px; height:44px; border-radius: 14px;
      background: linear-gradient(135deg, rgba(19,183,166,.95), rgba(42,165,255,.85));
      box-shadow: var(--shadow2);
      position:relative;
    }
    .logo:before{
      content:"";
      position:absolute; inset:10px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(255,255,255,.75), rgba(255,255,255,.25));
      transform: rotate(18deg);
    }
    h1{
      margin:0; font-size: 18px; letter-spacing:.5px;
    }
    .subtitle{
      margin:3px 0 0 0;
      font-size: 12px; color:var(--muted);
    }

    .actions{
      display:flex; align-items:center; gap:10px; flex-wrap:wrap;
    }
    .chip{
      display:inline-flex; align-items:center; gap:8px;
      border:1px solid var(--line);
      background: var(--card);
      padding: 10px 12px;
      border-radius: 999px;
      box-shadow: 0 6px 18px rgba(18,52,59,.06);
    }

    .input{
      width:min(340px, 70vw);
      border:none; outline:none;
      background: transparent;
      color:var(--text);
      font-size: 14px;
    }
    .btn{
      border:none; cursor:pointer;
      padding: 10px 12px;
      border-radius: 999px;
      background: linear-gradient(135deg, rgba(19,183,166,.95), rgba(42,165,255,.85));
      color:white;
      box-shadow: var(--shadow2);
      transition: transform .15s ease, filter .15s ease;
      font-size: 13px;
      white-space:nowrap;
    }
    .btn:hover{transform: translateY(-1px); filter: brightness(1.02);}
    .btn:active{transform: translateY(0px); filter: brightness(.98);}

    .btn.secondary{
      background: var(--card);
      color: var(--text);
      border:1px solid var(--line);
      box-shadow: 0 6px 18px rgba(18,52,59,.06);
    }

    main{padding: 16px 18px 40px;}
    .grid{
      display:grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 16px;
      max-width:1100px;
      margin: 0 auto;
    }

    .panel{
      grid-column: span 12;
      background: var(--card);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px 14px;
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      flex-wrap:wrap;
    }
    .filters{
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }
    .seg{
      display:flex; gap:8px; flex-wrap:wrap;
      padding: 6px;
      background: rgba(255,255,255,.35);
      border:1px solid rgba(255,255,255,.55);
      border-radius: 999px;
    }
    [data-theme="dark"] .seg{
      background: rgba(8,22,24,.25);
      border:1px solid rgba(20,58,64,.6);
    }
    .seg button{
      border:none; cursor:pointer;
      padding: 8px 12px;
      border-radius: 999px;
      background: transparent;
      color: var(--muted);
      transition: background .15s ease, color .15s ease;
      font-size: 13px;
    }
    .seg button[aria-pressed="true"]{
      background: linear-gradient(135deg, rgba(19,183,166,.22), rgba(42,165,255,.18));
      color: var(--text);
      border:1px solid rgba(19,183,166,.22);
    }

    .stats{
      font-size: 13px; color: var(--muted);
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .pill{
      padding: 6px 10px;
      border-radius: 999px;
      border:1px dashed rgba(19,183,166,.35);
      background: rgba(255,255,255,.30);
    }

    .card{
      grid-column: span 12;
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow2);
      padding: 14px 14px;
      position:relative;
      overflow:hidden;
      transition: transform .18s ease, box-shadow .18s ease;
    }
    @media (min-width: 760px){
      .card{grid-column: span 6;}
    }
    @media (min-width: 1020px){
      .card{grid-column: span 4;}
    }
    .card:hover{
      transform: translateY(-3px);
      box-shadow: var(--shadow);
    }

    .tag{
      display:inline-flex; align-items:center;
      padding: 6px 10px;
      border-radius: 999px;
      font-size: 12px;
      border: 1px solid rgba(19,183,166,.28);
      background: linear-gradient(135deg, rgba(19,183,166,.14), rgba(42,165,255,.10));
      color: var(--muted);
    }

    .head{
      display:flex; align-items:flex-start; justify-content:space-between; gap:10px;
      margin-bottom: 8px;
    }
    .name{
      margin:0;
      font-size: 16px;
      letter-spacing:.3px;
    }
    .alias{
      margin:4px 0 0 0;
      font-size: 12px; color: var(--muted);
    }
    .desc{
      margin: 10px 0 0 0;
      font-size: 13px;
      color: var(--text);
      line-height: 1.65;
    }
    .more{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed rgba(19,183,166,.28);
      color: var(--muted);
      font-size: 13px;
      line-height:1.6;
      display:none;
    }
    .card[data-open="true"] .more{display:block;}

    .cardActions{
      margin-top: 12px;
      display:flex; gap:10px; flex-wrap:wrap;
      align-items:center;
    }

    .ghost{
      border:1px solid var(--line);
      background: transparent;
      color: var(--text);
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 13px;
      transition: background .15s ease;
    }
    .ghost:hover{background: rgba(255,255,255,.25);}
    [data-theme="dark"] .ghost:hover{background: rgba(8,22,24,.22);}

    .fav{
      border:none;
      border-radius: 999px;
      padding: 8px 10px;
      cursor:pointer;
      font-size: 13px;
      background: rgba(19,183,166,.12);
      color: var(--text);
      border: 1px solid rgba(19,183,166,.25);
    }
    .fav[aria-pressed="true"]{
      background: linear-gradient(135deg, rgba(19,183,166,.35), rgba(42,165,255,.22));
      border: 1px solid rgba(19,183,166,.40);
    }

    .drawer{
      position:fixed;
      right:16px;
      bottom:16px;
      width:min(420px, calc(100vw - 32px));
      background: var(--card2);
      border: 1px solid var(--line);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
      transform: translateY(140%);
      transition: transform .22s ease;
      z-index: 20;
    }
    .drawer[data-open="true"]{transform: translateY(0);}
    .drawerHead{
      padding: 12px 14px;
      display:flex; align-items:center; justify-content:space-between;
      gap:10px;
      background: linear-gradient(135deg, rgba(19,183,166,.14), rgba(42,165,255,.10));
      border-bottom: 1px solid rgba(19,183,166,.18);
    }
    .drawerHead strong{font-size:14px;}
    .drawerBody{padding: 10px 14px; max-height: 42vh; overflow:auto;}
    .drawerItem{
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      padding: 10px 10px;
      border: 1px dashed rgba(19,183,166,.22);
      border-radius: 14px;
      margin-bottom: 10px;
      background: rgba(255,255,255,.22);
    }
    [data-theme="dark"] .drawerItem{background: rgba(8,22,24,.18);}

    .tiny{font-size:12px; color:var(--muted); margin:0;}
    .linkBtn{
      border:none; cursor:pointer;
      background: transparent;
      color: var(--brand2);
      font-size: 13px;
      padding: 6px 8px;
      border-radius: 10px;
    }
    .linkBtn:hover{background: rgba(42,165,255,.10);}

    footer{
      max-width:1100px;
      margin: 0 auto;
      padding: 12px 18px 30px;
      color: var(--muted);
      font-size: 12px;
      line-height:1.6;
    }
  </style>
</head>

<body>
  <div class="waves" aria-hidden="true"></div>

  <header>
    <div class="wrap">
      <div class="topbar">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div>
            <h1>è¥¿æ¸¸è®°äººç‰©å¿—</h1>
            <p class="subtitle">è“ç»¿è‰²æ¸…æ–°å”¯ç¾é£ Â· æœç´¢ / ç­›é€‰ / æ”¶è— / å±•å¼€äº¤äº’</p>
          </div>
        </div>

        <div class="actions">
          <div class="chip" title="è¾“å…¥å…³é”®è¯ï¼šå§“åã€åˆ«ç§°ã€å…³é”®è¯">
            <span style="opacity:.8">ğŸ”</span>
            <input id="q" class="input" placeholder="æœç´¢äººç‰©ï¼šå¦‚ å­™æ‚Ÿç©º / é‡‘ç®æ£’ / å–ç»â€¦" />
          </div>
          <button id="themeBtn" class="btn secondary" type="button">åˆ‡æ¢ä¸»é¢˜</button>
          <button id="favBtn" class="btn" type="button">æŸ¥çœ‹æ”¶è—</button>
        </div>
      </div>
    </div>
  </header>

  <main>
    <div class="grid">
      <section class="panel" aria-label="ç­›é€‰ä¸ç»Ÿè®¡">
        <div class="filters">
          <div class="seg" role="group" aria-label="é˜µè¥ç­›é€‰">
            <button class="segBtn" data-filter="all" aria-pressed="true">å…¨éƒ¨</button>
            <button class="segBtn" data-filter="team" aria-pressed="false">å–ç»å›¢é˜Ÿ</button>
            <button class="segBtn" data-filter="god" aria-pressed="false">ç¥ä»™</button>
            <button class="segBtn" data-filter="yao" aria-pressed="false">å¦–æ€ª</button>
          </div>
          <button id="resetBtn" class="btn secondary" type="button">æ¸…ç©ºæœç´¢</button>
        </div>

        <div class="stats">
          <span class="pill">å±•ç¤ºï¼š<b id="countNow">0</b> / <span id="countAll">0</span></span>
          <span class="pill">å·²æ”¶è—ï¼š<b id="countFav">0</b></span>
          <span class="pill">æç¤ºï¼šç‚¹å¡ç‰‡â€œå±•å¼€â€çœ‹æ›´å¤š</span>
        </div>
      </section>

      <div id="cards" class="grid" style="grid-column: span 12; padding:0; gap:16px;"></div>
    </div>
  </main>

  <div id="drawer" class="drawer" role="dialog" aria-label="æ”¶è—å¤¹" aria-modal="false" data-open="false">
    <div class="drawerHead">
      <strong>æ”¶è—å¤¹</strong>
      <div style="display:flex; gap:8px;">
        <button id="clearFavBtn" class="btn secondary" type="button">æ¸…ç©º</button>
        <button id="closeDrawerBtn" class="btn secondary" type="button">å…³é—­</button>
      </div>
    </div>
    <div id="drawerBody" class="drawerBody"></div>
  </div>

  <footer>
    è¯´æ˜ï¼šæœ¬é¡µä¸ºå­¦ä¹ æ¼”ç¤ºç”¨é€”ï¼›äººç‰©ç®€ä»‹ä¸ºæ¦‚è¿°æ€§è´¨ï¼ˆå¯è‡ªè¡Œæ›¿æ¢ä¸ºæ›´å®Œæ•´çš„ç‰ˆæœ¬ï¼‰ã€‚äº¤äº’ä¸æ”¶è—ä½¿ç”¨æµè§ˆå™¨æœ¬åœ°å­˜å‚¨ï¼ˆLocalStorageï¼‰ã€‚
  </footer>

  <script>
    const DATA = [
      {
        id: "wukong",
        name: "å­™æ‚Ÿç©º",
        alias: "é½å¤©å¤§åœ£ Â· ç¾çŒ´ç‹",
        camp: "team",
        tags: ["å–ç»å›¢é˜Ÿ","æ–—æˆ˜","æœºæ™º"],
        desc: "èŠ±æœå±±å‡ºä¸–ï¼Œå¸ˆæ‰¿è©æç¥–å¸ˆï¼Œæ‰‹æŒå¦‚æ„é‡‘ç®æ£’ã€‚æŠ¤å”åƒ§è¥¿è¡Œï¼Œé‡å¦–é™é­”ï¼Œæ€§çƒˆè€Œé‡æƒ…ä¹‰ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šæˆ˜åŠ›å¼ºã€ååº”å¿«ã€æ•¢æ‹…å½“ã€‚æˆé•¿çº¿ï¼šä»â€œæ¡€éªœä¸é©¯â€åˆ°â€œå®ˆæŠ¤ä¸å…‹åˆ¶â€ã€‚ä»£è¡¨ç‰©ï¼šé‡‘ç®æ£’ã€ç­‹æ–—äº‘ã€‚"
      },
      {
        id: "tangseng",
        name: "å”åƒ§",
        alias: "ç„å¥˜ Â· ä¸‰è—æ³•å¸ˆ",
        camp: "team",
        tags: ["å–ç»å›¢é˜Ÿ","æ…ˆæ‚²","ä¿¡å¿µ"],
        desc: "å¤§å”é«˜åƒ§ï¼Œå¥‰æ—¨è¥¿è¡Œå–ç»ã€‚ç§‰æŒæ…ˆæ‚²ä¸æˆ’å¾‹ï¼Œå¸¸ä»¥â€œæ­£å¿µâ€çº¦æŸå›¢é˜Ÿï¼Œæ„å¿—åšå®šã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šé“å¾·åæ ‡ä¸ç›®æ ‡æ„Ÿã€‚å±€é™ï¼šè¿‡åº¦ä¿¡ä»»ã€æ˜“å—è¿·æƒ‘ã€‚ä»£è¡¨ç‰©ï¼šä¹ç¯é”¡æ–ã€è¢ˆè£Ÿã€‚"
      },
      {
        id: "bajie",
        name: "çŒªå…«æˆ’",
        alias: "å¤©è“¬å…ƒå¸… Â· çŒªæ‚Ÿèƒ½",
        camp: "team",
        tags: ["å–ç»å›¢é˜Ÿ","æ†¨ç›´","çƒŸç«æ°”"],
        desc: "å‰èº«ä¸ºå¤©è“¬å…ƒå¸…ï¼Œä¸‹ç•Œåéšå”åƒ§å–ç»ã€‚å¥½åƒæ‡’åšå´ä¹ŸçœŸè¯šï¼Œå…³é”®æ—¶åˆ»èƒ½æ‰›äº‹ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šäººæ€§åŒ–ã€æ¥åœ°æ°”ã€åœ¨å›¢é˜Ÿé‡Œç¼“å†²å†²çªã€‚ä»£è¡¨ç‰©ï¼šä¹é½¿é’‰è€™ã€‚"
      },
      {
        id: "shaseng",
        name: "æ²™åƒ§",
        alias: "å·å¸˜å¤§å°† Â· æ²™æ‚Ÿå‡€",
        camp: "team",
        tags: ["å–ç»å›¢é˜Ÿ","ç¨³é‡","å¯é "],
        desc: "åŸä¸ºå¤©åº­å·å¸˜å¤§å°†ï¼Œåéšå”åƒ§è¥¿è¡Œã€‚å°‘è¨€å¯¡è¯­ï¼Œå–„åå‹¤ä¸å®ˆæŠ¤ï¼Œæ˜¯é˜Ÿä¼çš„ç¨³å®šå™¨ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šè€å¿ƒã€æ‰§è¡ŒåŠ›å¼ºã€æŠ—å‹ã€‚ä»£è¡¨ç‰©ï¼šé™å¦–å®æ–ã€‚"
      },
      {
        id: "guanyin",
        name: "è§‚éŸ³è©è¨",
        alias: "å¤§æ…ˆå¤§æ‚² Â· æ™®åº¦ä¼—ç”Ÿ",
        camp: "god",
        tags: ["ç¥ä»™","æ…ˆæ‚²","å¼•å¯¼"],
        desc: "å–ç»å·¥ç¨‹çš„é‡è¦æ¨åŠ¨è€…ä¹‹ä¸€ï¼Œå¤šæ¬¡åŒ–é™©ä¸ºå¤·ï¼Œæä¾›å…³é”®æŒ‡å¼•ä¸èµ„æºé…ç½®ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šä»¥æ…ˆæ‚²ä¸ºåº•è‰²çš„â€œç³»ç»Ÿè®¾è®¡è€…â€ã€‚å¸¸ä»¥ç‚¹åŒ–ã€åº¦åŒ–è€Œéå•çº¯æ­¦åŠ›è§£å†³çŸ›ç›¾ã€‚"
      },
      {
        id: "juling",
        name: "äºŒéƒç¥",
        alias: "æ¨æˆ¬ Â· æ¸…æºå¦™é“çœŸå›",
        camp: "god",
        tags: ["ç¥ä»™","å¼ºè€…","å…‹åˆ¶"],
        desc: "ä¸å­™æ‚Ÿç©ºæ–—æ³•æ——é¼“ç›¸å½“ï¼Œä»£è¡¨å¤©åº­ä½“ç³»ä¸­å¼ºæ‰§è¡Œä¸å¼ºçºªå¾‹çš„ä¸€é¢ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šå†·é™ã€åŸåˆ™æ€§å¼ºã€æˆ˜æœ¯ç´ å…»é«˜ã€‚è±¡å¾ï¼šä¸â€œé‡æ€§åŠ›é‡â€ç›¸å¯¹çš„â€œç§©åºåŠ›é‡â€ã€‚"
      },
      {
        id: "niumo",
        name: "ç‰›é­”ç‹",
        alias: "å¹³å¤©å¤§åœ£ Â· å¦–ç‹ä¹‹é›„",
        camp: "yao",
        tags: ["å¦–æ€ª","è±ªå¼º","äººæƒ…ç½‘"],
        desc: "å¦–ç•Œè±ªå¼ºï¼ŒåŠ¿åŠ›ç›˜æ ¹é”™èŠ‚ã€‚ä¸æ‚Ÿç©ºæ—¢æœ‰æ—§äº¤ä¹Ÿæœ‰å¯¹ç«‹ï¼Œä½“ç°â€œæ±Ÿæ¹–ä¸åˆ©ç›Šâ€çš„çº è‘›ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šèµ„æºä¸è”ç›Ÿèƒ½åŠ›å¼ºã€‚å†²çªç‚¹ï¼šæƒåŠ›ã€é¢å­ã€é˜µè¥é€‰æ‹©ã€‚"
      },
      {
        id: "baigujing",
        name: "ç™½éª¨ç²¾",
        alias: "ä¸‰ç•ªå˜åŒ– Â· è¯¡è®¡ä¹‹å¦–",
        camp: "yao",
        tags: ["å¦–æ€ª","ä¼ªè£…","è¯•æ¢äººå¿ƒ"],
        desc: "å–„äºå¹»åŒ–ï¼Œä»¥è¿ç¯ä¼ªè£…è¯•æ¢å–ç»å›¢é˜Ÿçš„ä¿¡ä»»ä¸åˆ¤æ–­ï¼Œåˆ¶é€ å†…éƒ¨è£‚ç—•ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šå¿ƒç†æˆ˜ä¸ä¿¡æ¯ä¸å¯¹ç§°ã€‚ä¸»é¢˜ï¼šå¤–éƒ¨å¨èƒå¦‚ä½•æ¿€åŒ–å†…éƒ¨çŸ›ç›¾ã€‚"
      },
      {
        id: "huangfeng",
        name: "é»„é£æ€ª",
        alias: "é»„é£å²­ Â· ä¸‰æ˜§ç¥é£",
        camp: "yao",
        tags: ["å¦–æ€ª","æ§åœº","é£æ²™"],
        desc: "ä»¥ç¥é£è§é•¿ï¼Œæ“…é•¿æ‹‰å¼€è·ç¦»ä¸æ§åœºï¼Œä½“ç°â€œç¯å¢ƒèƒ½åŠ›â€å¯¹æˆ˜å±€çš„å½±å“ã€‚",
        more: "æ ¸å¿ƒç‰¹ç‚¹ï¼šèŒƒå›´æŠ€èƒ½ä¸æˆ˜åœºå¡‘å½¢ã€‚å¯¹åº”ç ´è§£ï¼šå€ŸåŠ©æ›´é«˜å±‚æ¬¡åŠ›é‡ä¸ç­–ç•¥é…åˆã€‚"
      }
    ];

    const $ = (s, el=document) => el.querySelector(s);
    const $$ = (s, el=document) => Array.from(el.querySelectorAll(s));

    const cardsEl = $("#cards");
    const qEl = $("#q");
    const countNowEl = $("#countNow");
    const countAllEl = $("#countAll");
    const countFavEl = $("#countFav");
    const drawerEl = $("#drawer");
    const drawerBodyEl = $("#drawerBody");

    const LS_KEY_FAV = "xiyou_favs_v1";
    const LS_KEY_THEME = "xiyou_theme_v1";

    let state = {
      filter: "all",
      q: "",
      favs: loadFavs(),
      theme: loadTheme()
    };

    function loadFavs(){
      try{
        const raw = localStorage.getItem(LS_KEY_FAV);
        return raw ? JSON.parse(raw) : [];
      }catch(e){ return []; }
    }
    function saveFavs(){
      localStorage.setItem(LS_KEY_FAV, JSON.stringify(state.favs));
    }
    function loadTheme(){
      const t = localStorage.getItem(LS_KEY_THEME);
      return t === "dark" ? "dark" : "light";
    }
    function saveTheme(){
      localStorage.setItem(LS_KEY_THEME, state.theme);
    }

    function applyTheme(){
      document.documentElement.setAttribute("data-theme", state.theme);
      $("#themeBtn").textContent = state.theme === "dark" ? "åˆ‡æ¢åˆ°æµ…è‰²" : "åˆ‡æ¢åˆ°æ·±è‰²";
    }

    function match(item){
      const byFilter = state.filter === "all" ? true : item.camp === state.filter;
      const kw = state.q.trim().toLowerCase();
      if(!kw) return byFilter;

      const hay = [
        item.name, item.alias, item.desc, item.more,
        ...(item.tags||[])
      ].join(" ").toLowerCase();

      return byFilter && hay.includes(kw);
    }

    function render(){
      const list = DATA.filter(match);
      countAllEl.textContent = DATA.length;
      countNowEl.textContent = list.length;
      countFavEl.textContent = state.favs.length;

      cardsEl.innerHTML = list.map(item => {
        const isFav = state.favs.includes(item.id);
        return `
          <article class="card" data-id="${item.id}" data-open="false">
            <div class="head">
              <div>
                <h3 class="name">${item.name}</h3>
                <p class="alias">${item.alias}</p>
              </div>
              <span class="tag">${campLabel(item.camp)}</span>
            </div>

            <div style="display:flex; gap:8px; flex-wrap:wrap; margin-top:6px;">
              ${(item.tags||[]).map(t=>`<span class="tag" style="border-style:dashed; opacity:.95">${t}</span>`).join("")}
            </div>

            <p class="desc">${item.desc}</p>
            <div class="more">${item.more}</div>

            <div class="cardActions">
              <button class="ghost toggleMore" type="button">å±•å¼€</button>
              <button class="fav toggleFav" type="button" aria-pressed="${isFav}">
                ${isFav ? "å·²æ”¶è—" : "æ”¶è—"}
              </button>
              <button class="ghost quickFind" type="button" title="ä¸€é”®æœç´¢æ­¤äººç‰©å…³é”®è¯">åŒç±»å…³é”®è¯</button>
            </div>
          </article>
        `;
      }).join("");

      bindCardEvents();
      renderDrawer();
    }

    function campLabel(c){
      if(c==="team") return "å–ç»å›¢é˜Ÿ";
      if(c==="god") return "ç¥ä»™";
      if(c==="yao") return "å¦–æ€ª";
      return "å…¨éƒ¨";
    }

    function bindCardEvents(){
      $$(".toggleMore", cardsEl).forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const card = e.target.closest(".card");
          const open = card.getAttribute("data-open") === "true";
          card.setAttribute("data-open", String(!open));
          e.target.textContent = open ? "å±•å¼€" : "æ”¶èµ·";
        });
      });

      $$(".toggleFav", cardsEl).forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const card = e.target.closest(".card");
          const id = card.getAttribute("data-id");
          toggleFav(id);
        });
      });

      $$(".quickFind", cardsEl).forEach(btn=>{
        btn.addEventListener("click", (e)=>{
          const card = e.target.closest(".card");
          const id = card.getAttribute("data-id");
          const item = DATA.find(x=>x.id===id);
          // å–ç¬¬ä¸€ä¸ª tag ä½œä¸ºå¿«æ·æœç´¢è¯ï¼ˆä½ ä¹Ÿå¯æ”¹æˆ name/aliasï¼‰
          const kw = (item.tags && item.tags[0]) ? item.tags[0] : item.name;
          state.q = kw;
          qEl.value = kw;
          render();
        });
      });
    }

    function toggleFav(id){
      const i = state.favs.indexOf(id);
      if(i>=0) state.favs.splice(i,1);
      else state.favs.unshift(id);
      saveFavs();
      render();
    }

    function renderDrawer(){
      const favItems = state.favs.map(id => DATA.find(x=>x.id===id)).filter(Boolean);

      drawerBodyEl.innerHTML = favItems.length ? favItems.map(it => `
        <div class="drawerItem">
          <div>
            <div style="font-weight:600">${it.name}</div>
            <p class="tiny">${it.alias}</p>
          </div>
          <button class="linkBtn" type="button" data-unfav="${it.id}">ç§»é™¤</button>
        </div>
      `).join("") : `
        <p class="tiny">è¿˜æ²¡æœ‰æ”¶è—ä»»ä½•äººç‰©ã€‚å›åˆ°å¡ç‰‡ç‚¹â€œæ”¶è—â€å³å¯åŠ å…¥ã€‚</p>
      `;

      $$("[data-unfav]", drawerBodyEl).forEach(btn=>{
        btn.addEventListener("click", ()=>{
          toggleFav(btn.getAttribute("data-unfav"));
        });
      });
    }

    // é¡¶éƒ¨ï¼šæœç´¢
    qEl.addEventListener("input", ()=>{
      state.q = qEl.value;
      render();
    });

    // é˜µè¥ç­›é€‰
    $$(".segBtn").forEach(btn=>{
      btn.addEventListener("click", ()=>{
        state.filter = btn.dataset.filter;
        $$(".segBtn").forEach(x=>x.setAttribute("aria-pressed","false"));
        btn.setAttribute("aria-pressed","true");
        render();
      });
    });

    // æ¸…ç©ºæœç´¢
    $("#resetBtn").addEventListener("click", ()=>{
      state.q = "";
      qEl.value = "";
      render();
    });

    // ä¸»é¢˜åˆ‡æ¢
    $("#themeBtn").addEventListener("click", ()=>{
      state.theme = state.theme === "dark" ? "light" : "dark";
      saveTheme();
      applyTheme();
    });

    // æ”¶è—æŠ½å±‰
    $("#favBtn").addEventListener("click", ()=>{
      drawerEl.setAttribute("data-open", "true");
    });
    $("#closeDrawerBtn").addEventListener("click", ()=>{
      drawerEl.setAttribute("data-open", "false");
    });
    $("#clearFavBtn").addEventListener("click", ()=>{
      state.favs = [];
      saveFavs();
      render();
    });

    // åˆå§‹åŒ–
    applyTheme();
    render();
  </script>
</body>
</html>
